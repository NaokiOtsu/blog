<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="lang">
  <head data-n-head="">
    <title data-n-head="true">CSSアニメーションのスマホ(iOS/Android)で起きる不具合/バグ | Naoki Otsu</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="true" data-hid="apple-mobile-web-app-title" name="apple-mobile-web-app-title" content="NaokiOtsu"><meta data-n-head="true" data-hid="author" name="author" content="NaokiOtsu"><meta data-n-head="true" data-hid="theme-color" name="theme-color" content="#3B8070"><meta data-n-head="true" data-hid="og:type" name="og:type" property="og:type" content="website"><meta data-n-head="true" data-hid="og:title" name="og:title" property="og:title" content="NaokiOtsu"><meta data-n-head="true" data-hid="og:site_name" name="og:site_name" property="og:site_name" content="NaokiOtsu"><meta data-n-head="true" data-hid="og:description" name="og:description" property="og:description" content="フロントエンド(Vue, React, ReactNative, Electron..)、バックエンド(Ruby, GraphQL..)、書籍(スタートアップ, 経営者..)から学んだことを発信する場"><meta data-n-head="true" data-hid="description" name="description" content="普段のスマホのコーディングでは、かなり多くのユーザーを抱えたWeb開発に携わらせて頂いていますが、そうするとCSSアニメーションで「動かない」などの声を頂くことも多くあり、どんな書き方をすると、どの端末で動かない事があるのか。またその対応策など、自分の遭遇したもの中心に記載しておこうと思います。## transformが含まれた複数プロパティをアニメーションさせた時にAndroid2系で動かない`「transform + 任意のプロパティ」`をアニメーションさせた時に、keyframesの指定が 0% → 100% となっているとAndroid2系で動きません。よくある要件としては、`「移動させながらopacityを1にする」「縮小しながらopacityを0にする」`などでしょうか。**動かない書き方**```css.test {  -webkit-animation: hoge 2s infinite;}@-webkit-keyframes hoge {  0%   { -webkit-transform: translate(0, 0);     opacity: 0; }  100% { -webkit-transform: translate(100px, 0); opacity: 1; }}```結論、「100%」→`「99.9%,to」`と書くと動きますので、keyframesの指定は`「99.9%,to」`の書き方で統一しておくと良さそうです。**動く書き方**```css@-webkit-keyframes hoge {    0%       { -webkit-transform: translate(0, 0);     opacity: 0; }    99.9%,to { -webkit-transform: translate(100px, 0); opacity: 1; }}```translateだけのアニメーションでは、「100%」にしても不具合は発生しませんでしたので、組み合わせてアニメーションした場合に限り発生するようです。## animation-fill-modeを指定すると、Android2系で動かない`animation-fill-mode`は、Android2系がサポートされておらず、指定するとアニメーションが動かなくなります。**動かない書き方**```css.box {  width: 50px;  height: 50px;  background: black;  -webkit-animation: hoge 1s forwards;}@-webkit-keyframes hoge {  0%       { opacity: 1; }  99.9%,to { opacity: 0; }}```この場合、`opacity`の初期値を予め設定しておき`forwards`を削除する事でAndroid2系でも動くようになります。初め`forwards`をサポートしてないブラウザは、単に無視されるのかなと思いましたが、指定されていただけで動かなくなりましたので、指定は削除する必要がありそうでした。**動く書き方**```css.box {  width: 50px;  height: 50px;  background: black;  opacity: 0;  -webkit-animation: hoge 1s;}```## 擬似要素へのアニメーションがAndroid2,4系で動かない`:before` や `:after` の擬似要素ですが、PCやiOSは動作確認出来ましたが、Android2,4系でも動かない端末がありました。現状、擬似要素へのアニメーションが必要な場合は、`span`タグなどで代替する必要がありそうです。## transformの値を省略すると動かない例えば、「拡大しながら右にアニメーションしたい」という時に、下記のように0%時の`translateX()`を省略すると、Chromeなどでも動作確認出来ませんでした。**動かない書き方**```css.box {  width: 50px;  height: 50px;  background-color: black;  -webkit-animation: hoge 1s infinite;}@-webkit-keyframes hoge {  0%       { -webkit-transform: scale(0); }  99.9%,to { -webkit-transform: scale(1) translateX(100px); }}```0%時のプロパティも省略せずに記述することで回避できます。**動く書き方**```css.box {  width: 50px;  height: 50px;  background-color: black;  -webkit-animation: hoge 1s infinite;}@-webkit-keyframes hoge {  0%       { -webkit-transform: scale(0) translateX(0); }  99.9%,to { -webkit-transform: scale(1) translateX(100px); }}```## animation-timing-function: steps()はAndroid2系がサポートしていないコマ送りのスプライト画像を準備して、`animation-timing-functionのsteps()`を使ってコマ送りアニメーションを実装する方法がありますが、Android2系でサポートしていない為、もし実装したい場合はJavaScriptなどを使用する必要がありそうです。steps()の実装方法については下記が参考になります。[CSSスプライトとstepsを使ってアニメーション画像を作ろう](http://www.webcreatorbox.com/tech/css-sprite-steps/)```css.box {  width: 50px;  height: 50px;  background-image: url(../images/heart.png);  background-size: 1450px auto;  -webkit-animation: hoge 1s steps(29) infinite;}@-webkit-keyframes hoge {  0%       { background-position: 0 0; }  99.9%,to { background-position: -1450px 0; }}```また、`animation-timing-function`の`cubic-bezier()`もAndroid2,4系で対応してない端末があるため(5系から正常に動作。)、スマホ案件では、`ease-in-out`や`linear`などの基本指定に留めておいたほうがよさそうです..。PCでは問題なさそうです。## dispalayとopacityをtransitionさせる時の注意点例えば、最初は`display: none;`な要素を、class付与のタイミングで`display: block;`にすると同時にフェードインさせたい時に、`transition`でアニメーションさせる場合の注意点です。下記のように実装すれば問題なさそうに見えますが、一瞬でboxが表示されてしまい意図した動作にならない場合があります。**意図しない動作の書き方**```css.box {  width: 50px;  height: 50px;  background: black;  display: none;  opacity: 0;  -webkit-transition: opacity 1s;}.box.active {  display: block;  opacity: 1;}```こちらの対応策はいくつか方法がありそうですが、簡単なものだと`animation`の`keyframes`を使用することで回避出来ます。**意図した動作の書き方**```css.box {  width: 50px;  height: 50px;  background: black;  display: none;}.box.active {  display: block;  opacity: 1;  -webkit-animation: hoge 1s;}@-webkit-keyframes hoge {  0%   { opacity: 0; }  100% { opacity: 1; }}```## translateとrotateを同時にアニメーションさせる場合は、記述順で動作が異なるこちら色々な端末で確認できましたが、例えば、回転させながら横に動かしたい時に、下記のような実装をすると意図した動作となります。```css.box {  width: 100px;  height: 100px;  background-color: black;  -webkit-animation: hoge 1s infinite;}@-webkit-keyframes hoge {  0%       { -webkit-transform: translateX(0) rotate(0); }  99.9%,to { -webkit-transform: translateX(100px) rotate(180deg); }}```ただ、下記のように`rotate`プロパティを先に記述してしまうと基準点が変わってしまい、意図した動作になりませんでした。```css@-webkit-keyframes hoge {  0%       { -webkit-transform: rotate(0) translateX(0) ; }  99.9%,to { -webkit-transform: rotate(180deg) translateX(100px); }}````translate`と`rotate`を組み合わせる場合は、`translate`を先に書くようにしておくと良さそうです。## 3d系の指定をすると、Android2系でおかしな挙動となる場合がある端末のGPUを使用する為に、下記のようなプロパティを指定する事があるのですが* transform: translate3d(0,0,0);* transform: translateZ(0);* backface-visibility: hidden;指定するとAndroid2系でいくつか不具合があがっているようです。* フォーム関連要素がページ内にあった場合に、タップ位置が変わったりといった挙動がおかしくなる。* scale, rotate, skewのtransformプロパティが正常に動作しなくなる。* 特定のCSSプロパティの上書きが反映されなくなる (positionなど)JIRAなどでAndroid2系のみおかしな挙動が起きた場合は、ページ内の3d系プロパティを疑うのも1つの解決方法となりそうです。## 使用できるプロパティ、使用出来ないプロパティを調べてみたところ...transform系以外のプロパティは、Android2系でも問題なく動作していそうです。例: `opacity, background-color, box-shadow`など。transform系でAndroid2系も含めて動作確認出来たのは、`translateX, translateY, scaleX, scaleY, rotate, skewX, skewY, transform-origin, matrix`などでした。Android2系で、動作確認出来なかったプロパティは、`translateZ, rotateX, rotateY, perspective`などの3d系プロパティが使えないようです。Android2系までサポートしようとすると3D系のアニメーションは厳しい状況です。2DのアニメーションであればAndroid2系含めて動作しますので(複雑でたくさん動かしたい場合はパフォーマンス的に厳しそうですが..)、様々な場面で検討していくと良さそうです。## 不具合への対策まとめ・`keyframes`は`「100%」→「99.9%, to」`と書く。・`animation-fill-mode`(bothやforwardsなど)は、Android2系で使えないので注意する。初期値を予め設定しておくと良い。・`cubic-bezier()`は、Android2系では使えない。・疑似要素でアニメーションが必要な場合は、`span`タグなどで代替する。・`keyframes`内の、各％のプロパティは省略せずに記述する。・`animation-timing-function: steps();`はAndroid2系がサポートしていない・`dispalay`と`opacity`を併用したアニメーションでは、`keyframes`を使用すると良い。・`translate`と`rotate`を同時にアニメーションさせる場合は、`translate`を先に記述する。・3d系のプロパティ(`translate3d, backface-visibility: hidden;`)の指定がある場合は、Android2系で不具合が起きる可能性があることを知っておく。以上になります。間違ってるところなどありましたら、ご連絡頂けると有難いです。今後のCSSアニメーション実装の参考にして頂ければと思います。"><meta data-n-head="true" name="twitter:card" content="summary"><meta data-n-head="true" name="og:title" content="CSSアニメーションのスマホ(iOS/Android)で起きる不具合/バグ"><meta data-n-head="true" name="og:description" content="普段のスマホのコーディングでは、かなり多くのユーザーを抱えたWeb開発に携わらせて頂いていますが、そうするとCSSアニメーションで「動かない」などの声を頂くことも多くあり、どんな書き方をすると、どの端末で動かない事があるのか。またその対応策など、自分の遭遇したもの中心に記載しておこうと思います。## transformが含まれた複数プロパティをアニメーションさせた時にAndroid2系で動かない`「transform + 任意のプロパティ」`をアニメーションさせた時に、keyframesの指定が 0% → 100% となっているとAndroid2系で動きません。よくある要件としては、`「移動させながらopacityを1にする」「縮小しながらopacityを0にする」`などでしょうか。**動かない書き方**```css.test {  -webkit-animation: hoge 2s infinite;}@-webkit-keyframes hoge {  0%   { -webkit-transform: translate(0, 0);     opacity: 0; }  100% { -webkit-transform: translate(100px, 0); opacity: 1; }}```結論、「100%」→`「99.9%,to」`と書くと動きますので、keyframesの指定は`「99.9%,to」`の書き方で統一しておくと良さそうです。**動く書き方**```css@-webkit-keyframes hoge {    0%       { -webkit-transform: translate(0, 0);     opacity: 0; }    99.9%,to { -webkit-transform: translate(100px, 0); opacity: 1; }}```translateだけのアニメーションでは、「100%」にしても不具合は発生しませんでしたので、組み合わせてアニメーションした場合に限り発生するようです。## animation-fill-modeを指定すると、Android2系で動かない`animation-fill-mode`は、Android2系がサポートされておらず、指定するとアニメーションが動かなくなります。**動かない書き方**```css.box {  width: 50px;  height: 50px;  background: black;  -webkit-animation: hoge 1s forwards;}@-webkit-keyframes hoge {  0%       { opacity: 1; }  99.9%,to { opacity: 0; }}```この場合、`opacity`の初期値を予め設定しておき`forwards`を削除する事でAndroid2系でも動くようになります。初め`forwards`をサポートしてないブラウザは、単に無視されるのかなと思いましたが、指定されていただけで動かなくなりましたので、指定は削除する必要がありそうでした。**動く書き方**```css.box {  width: 50px;  height: 50px;  background: black;  opacity: 0;  -webkit-animation: hoge 1s;}```## 擬似要素へのアニメーションがAndroid2,4系で動かない`:before` や `:after` の擬似要素ですが、PCやiOSは動作確認出来ましたが、Android2,4系でも動かない端末がありました。現状、擬似要素へのアニメーションが必要な場合は、`span`タグなどで代替する必要がありそうです。## transformの値を省略すると動かない例えば、「拡大しながら右にアニメーションしたい」という時に、下記のように0%時の`translateX()`を省略すると、Chromeなどでも動作確認出来ませんでした。**動かない書き方**```css.box {  width: 50px;  height: 50px;  background-color: black;  -webkit-animation: hoge 1s infinite;}@-webkit-keyframes hoge {  0%       { -webkit-transform: scale(0); }  99.9%,to { -webkit-transform: scale(1) translateX(100px); }}```0%時のプロパティも省略せずに記述することで回避できます。**動く書き方**```css.box {  width: 50px;  height: 50px;  background-color: black;  -webkit-animation: hoge 1s infinite;}@-webkit-keyframes hoge {  0%       { -webkit-transform: scale(0) translateX(0); }  99.9%,to { -webkit-transform: scale(1) translateX(100px); }}```## animation-timing-function: steps()はAndroid2系がサポートしていないコマ送りのスプライト画像を準備して、`animation-timing-functionのsteps()`を使ってコマ送りアニメーションを実装する方法がありますが、Android2系でサポートしていない為、もし実装したい場合はJavaScriptなどを使用する必要がありそうです。steps()の実装方法については下記が参考になります。[CSSスプライトとstepsを使ってアニメーション画像を作ろう](http://www.webcreatorbox.com/tech/css-sprite-steps/)```css.box {  width: 50px;  height: 50px;  background-image: url(../images/heart.png);  background-size: 1450px auto;  -webkit-animation: hoge 1s steps(29) infinite;}@-webkit-keyframes hoge {  0%       { background-position: 0 0; }  99.9%,to { background-position: -1450px 0; }}```また、`animation-timing-function`の`cubic-bezier()`もAndroid2,4系で対応してない端末があるため(5系から正常に動作。)、スマホ案件では、`ease-in-out`や`linear`などの基本指定に留めておいたほうがよさそうです..。PCでは問題なさそうです。## dispalayとopacityをtransitionさせる時の注意点例えば、最初は`display: none;`な要素を、class付与のタイミングで`display: block;`にすると同時にフェードインさせたい時に、`transition`でアニメーションさせる場合の注意点です。下記のように実装すれば問題なさそうに見えますが、一瞬でboxが表示されてしまい意図した動作にならない場合があります。**意図しない動作の書き方**```css.box {  width: 50px;  height: 50px;  background: black;  display: none;  opacity: 0;  -webkit-transition: opacity 1s;}.box.active {  display: block;  opacity: 1;}```こちらの対応策はいくつか方法がありそうですが、簡単なものだと`animation`の`keyframes`を使用することで回避出来ます。**意図した動作の書き方**```css.box {  width: 50px;  height: 50px;  background: black;  display: none;}.box.active {  display: block;  opacity: 1;  -webkit-animation: hoge 1s;}@-webkit-keyframes hoge {  0%   { opacity: 0; }  100% { opacity: 1; }}```## translateとrotateを同時にアニメーションさせる場合は、記述順で動作が異なるこちら色々な端末で確認できましたが、例えば、回転させながら横に動かしたい時に、下記のような実装をすると意図した動作となります。```css.box {  width: 100px;  height: 100px;  background-color: black;  -webkit-animation: hoge 1s infinite;}@-webkit-keyframes hoge {  0%       { -webkit-transform: translateX(0) rotate(0); }  99.9%,to { -webkit-transform: translateX(100px) rotate(180deg); }}```ただ、下記のように`rotate`プロパティを先に記述してしまうと基準点が変わってしまい、意図した動作になりませんでした。```css@-webkit-keyframes hoge {  0%       { -webkit-transform: rotate(0) translateX(0) ; }  99.9%,to { -webkit-transform: rotate(180deg) translateX(100px); }}````translate`と`rotate`を組み合わせる場合は、`translate`を先に書くようにしておくと良さそうです。## 3d系の指定をすると、Android2系でおかしな挙動となる場合がある端末のGPUを使用する為に、下記のようなプロパティを指定する事があるのですが* transform: translate3d(0,0,0);* transform: translateZ(0);* backface-visibility: hidden;指定するとAndroid2系でいくつか不具合があがっているようです。* フォーム関連要素がページ内にあった場合に、タップ位置が変わったりといった挙動がおかしくなる。* scale, rotate, skewのtransformプロパティが正常に動作しなくなる。* 特定のCSSプロパティの上書きが反映されなくなる (positionなど)JIRAなどでAndroid2系のみおかしな挙動が起きた場合は、ページ内の3d系プロパティを疑うのも1つの解決方法となりそうです。## 使用できるプロパティ、使用出来ないプロパティを調べてみたところ...transform系以外のプロパティは、Android2系でも問題なく動作していそうです。例: `opacity, background-color, box-shadow`など。transform系でAndroid2系も含めて動作確認出来たのは、`translateX, translateY, scaleX, scaleY, rotate, skewX, skewY, transform-origin, matrix`などでした。Android2系で、動作確認出来なかったプロパティは、`translateZ, rotateX, rotateY, perspective`などの3d系プロパティが使えないようです。Android2系までサポートしようとすると3D系のアニメーションは厳しい状況です。2DのアニメーションであればAndroid2系含めて動作しますので(複雑でたくさん動かしたい場合はパフォーマンス的に厳しそうですが..)、様々な場面で検討していくと良さそうです。## 不具合への対策まとめ・`keyframes`は`「100%」→「99.9%, to」`と書く。・`animation-fill-mode`(bothやforwardsなど)は、Android2系で使えないので注意する。初期値を予め設定しておくと良い。・`cubic-bezier()`は、Android2系では使えない。・疑似要素でアニメーションが必要な場合は、`span`タグなどで代替する。・`keyframes`内の、各％のプロパティは省略せずに記述する。・`animation-timing-function: steps();`はAndroid2系がサポートしていない・`dispalay`と`opacity`を併用したアニメーションでは、`keyframes`を使用すると良い。・`translate`と`rotate`を同時にアニメーションさせる場合は、`translate`を先に記述する。・3d系のプロパティ(`translate3d, backface-visibility: hidden;`)の指定がある場合は、Android2系で不具合が起きる可能性があることを知っておく。以上になります。間違ってるところなどありましたら、ご連絡頂けると有難いです。今後のCSSアニメーション実装の参考にして頂ければと思います。"><meta data-n-head="true" name="og:image" content="https://blog.naoki-otsu.com/icon.png"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="manifest" href="/_nuxt/manifest.cf01dff4.json"><link data-n-head="true" rel="shortcut icon" href="/_nuxt/icons/icon_64.bM0Ug3708o0.png"><link data-n-head="true" rel="apple-touch-icon" href="/_nuxt/icons/icon_512.bM0Ug3708o0.png" sizes="512x512"><base href="/"><link rel="preload" href="/_nuxt/35f5d4cd1087fd4c05c1.js" as="script"><link rel="preload" href="/_nuxt/48b5a157089511bc5650.js" as="script"><link rel="preload" href="/_nuxt/8f47e504b4adc19ec417.js" as="script"><link rel="preload" href="/_nuxt/7d37de19250f8e71d169.js" as="script"><link rel="preload" href="/_nuxt/0dbcd20913a7f489c3b7.js" as="script"><style data-vue-ssr-id="2c951650:0 b15e4592:0 2fff0774:0 c7c745fa:0 17cfdfa9:0 85dd2496:0 637c0f0c:0">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}:root{font-size:10px}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-webkit-font-smoothing:subpixel-antialiased;-moz-osx-font-smoothing:unset;font-family:-apple-system,BlinkMacSystemFont,Helvetica Neue,Yu Gothic,YuGothic,Verdana,Meiryo,sans-serif;font-size:1.6rem;line-height:1.8;letter-spacing:.5px;color:#1d2129;word-wrap:break-word}@media (-webkit-min-device-pixel-ratio:2),(min-resolution:2dppx),only screen and (-webkit-min-device-pixel-ratio:2){html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}a{color:#365899;text-decoration:none;-webkit-tap-highlight-color:transparent}a:hover{text-decoration:underline}img{vertical-align:bottom}.hljs{display:block;overflow-x:auto;padding:.5em;background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}header[data-v-2504b6de]{display:flex;align-items:center;justify-content:space-between;padding:10px 20px 10px 10px;background:#333;border-bottom:1px solid #000}header a[data-v-2504b6de],header[data-v-2504b6de]{color:#fff}header h1[data-v-2504b6de]{margin:0;font-size:1.6rem;font-weight:400;line-height:1.2}header h1 a[data-v-2504b6de]:hover{text-decoration:none}header h1 span[data-v-2504b6de]{margin-right:2px;font-weight:700}header ul[data-v-2504b6de]{display:flex;margin:0;padding:0;font-size:1.4rem;list-style-type:none}header li[data-v-2504b6de]{margin-left:20px}@media (max-width:900px){header li[data-v-2504b6de]{margin-left:8px}}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.container[data-v-6b5526b6]{max-width:880px;margin:50px auto;font-size:1.6rem}.container h1[data-v-6b5526b6]{font-size:4.2rem;line-height:5.7rem;font-weight:600}.container .date[data-v-6b5526b6]{text-align:right}.container .contents[data-v-6b5526b6]{margin-bottom:40px;color:#4b4f56}.container .contents[data-v-6b5526b6] h1{margin:60px 0 10px;padding-bottom:10px;font-size:2.6rem;line-height:4.2rem;border-bottom:2px solid #efefef}.container .contents[data-v-6b5526b6] h2{margin:40px 0 0;font-size:2rem;line-height:3rem}.container .contents[data-v-6b5526b6] ul{margin-top:24px}.container .contents[data-v-6b5526b6] li{margin-bottom:4px}.container .contents[data-v-6b5526b6] img{display:inline-block;margin-top:20px;margin-bottom:20px}.container .contents[data-v-6b5526b6] p{margin:20px 0 4px}.container .contents[data-v-6b5526b6] a{text-decoration:underline}.container .contents[data-v-6b5526b6] p code,.container .contents[data-v-6b5526b6] ul code{margin:0 4px;color:#ca454e}.container .contents[data-v-6b5526b6] .hljs{padding:1em 24px;background-color:#364549}.container .contents[data-v-6b5526b6] .touchlife-img{width:340px}.container .sns[data-v-6b5526b6]{display:flex;align-items:center}.container .twitter[data-v-6b5526b6]{margin-right:10px}@media (max-width:900px){.container[data-v-6b5526b6]{margin:20px auto;padding:0 16px}.container h1[data-v-6b5526b6]{margin:0 0 10px;font-size:2.2rem;line-height:3rem}.container .date[data-v-6b5526b6]{margin:0;font-size:1.3rem}.container .contents[data-v-6b5526b6]{line-height:1.6}.container .contents[data-v-6b5526b6] h1{margin:40px 0 0;padding-bottom:6px;font-size:2rem;line-height:3rem;border-bottom:2px solid #efefef}.container .contents[data-v-6b5526b6] h2{margin:30px 0 0;font-size:1.6rem;line-height:2.2rem}.container .contents[data-v-6b5526b6] img{width:100%}.container .contents[data-v-6b5526b6] p{margin-top:12px}.container .contents[data-v-6b5526b6] p code{white-space:normal}.container .contents[data-v-6b5526b6] ul{margin-top:16px;padding-left:30px}.container .contents[data-v-6b5526b6] li{margin-bottom:4px}.container .contents[data-v-6b5526b6] pre{overflow:auto;word-wrap:normal;white-space:pre;-webkit-overflow-scrolling:touch;overflow-scrolling:touch;margin:12px -16px}.container .contents[data-v-6b5526b6] .hljs{padding:1em 16px;-webkit-text-size-adjust:none}.container .contents[data-v-6b5526b6] .touchlife-img{width:245px}}footer[data-v-7bad5fd4]{padding:10px 0;color:#fff;font-size:14px;background:#333}footer .container[data-v-7bad5fd4]{max-width:880px;margin:0 auto}footer h2[data-v-7bad5fd4]{margin:0 0 20px;padding-top:20px;font-size:2.4rem}footer .md-large[data-v-7bad5fd4]{width:160px;height:160px;border-radius:160px}footer .box[data-v-7bad5fd4]{display:flex;margin-bottom:20px}footer .profile[data-v-7bad5fd4]{margin-top:5px;border-radius:50%}footer .info[data-v-7bad5fd4]{flex:1;margin-left:26px}footer .info h3[data-v-7bad5fd4]{margin-top:0;margin-bottom:0}footer .info p[data-v-7bad5fd4]{margin-top:4px}footer .info ul[data-v-7bad5fd4]{margin:20px 0 0;padding:0;list-style-type:none}footer .info li[data-v-7bad5fd4]{display:flex;align-items:center;margin-bottom:10px}footer .info li a[data-v-7bad5fd4]{margin-right:10px;color:#fff}footer .info .follow[data-v-7bad5fd4]{position:relative;top:4px}footer address[data-v-7bad5fd4]{margin:0;text-align:center;font-style:normal}@media (max-width:900px){footer[data-v-7bad5fd4]{padding:10px}footer h2[data-v-7bad5fd4]{margin:10px 0;padding:0;font-size:1.8rem;line-height:1.4}footer .box[data-v-7bad5fd4]{align-items:flex-start}footer .profile[data-v-7bad5fd4]{width:100px;height:100px}footer .info[data-v-7bad5fd4]{margin-left:16px;line-height:1.4}footer .info h3[data-v-7bad5fd4]{margin:0 0 4px;font-size:1.6rem}footer p[data-v-7bad5fd4]{margin:0 0 10px;font-size:1.3rem}footer ul[data-v-7bad5fd4]{font-size:1.2rem}footer address[data-v-7bad5fd4]{line-height:1.6}}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt" data-v-2504b6de><!----><div id="__layout" data-v-2504b6de data-v-2504b6de data-v-2504b6de><div data-v-2504b6de data-v-2504b6de><header data-v-2504b6de data-v-2504b6de><h1 data-v-2504b6de><a href="/" class="nuxt-link-active" data-v-2504b6de data-v-2504b6de>Naoki <span data-v-2504b6de data-v-2504b6de>Otsu</span></a></h1> <nav data-v-2504b6de><ul data-v-2504b6de><li data-v-2504b6de><a href="/" class="nuxt-link-active" data-v-2504b6de data-v-2504b6de>Blog</a></li> <li data-v-2504b6de><a href="/profile/" data-v-2504b6de data-v-2504b6de>Profile</a></li> <li data-v-2504b6de><a href="https://twitter.com/melo15" target="_blank" rel="noopener" data-v-2504b6de>Twitter</a></li> <li data-v-2504b6de><a href="https://github.com/NaokiOtsu" target="_blank" rel="noopener" data-v-2504b6de>Github</a></li></ul></nav></header> <div class="container" data-v-6b5526b6 data-v-2504b6de data-v-2504b6de data-v-2504b6de><h1 data-v-6b5526b6>CSSアニメーションのスマホ(iOS/Android)で起きる不具合/バグ</h1> <p class="date" data-v-6b5526b6>2016-12-05</p> <div class="contents" data-v-6b5526b6><section><p>普段のスマホのコーディングでは、かなり多くのユーザーを抱えたWeb開発に携わらせて頂いていますが、<br>
そうするとCSSアニメーションで「動かない」などの声を頂くことも多くあり、<br>
どんな書き方をすると、どの端末で動かない事があるのか。<br>
またその対応策など、自分の遭遇したもの中心に記載しておこうと思います。</p>
<h2>transformが含まれた複数プロパティをアニメーションさせた時にAndroid2系で動かない</h2>
<p><code>「transform + 任意のプロパティ」</code>をアニメーションさせた時に、<br>
keyframesの指定が 0% → 100% となっているとAndroid2系で動きません。<br>
よくある要件としては、<code>「移動させながらopacityを1にする」「縮小しながらopacityを0にする」</code>などでしょうか。</p>
<p><strong>動かない書き方</strong></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.test</span> {
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">2s</span> infinite;
}
@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%   { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(0, 0);     <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
  100% { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(100px, 0); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
}
</code></pre>
<p>結論、「100%」→<code>「99.9%,to」</code>と書くと動きますので、<br>
keyframesの指定は<code>「99.9%,to」</code>の書き方で統一しておくと良さそうです。</p>
<p><strong>動く書き方</strong></p>
<pre><code class="hljs language-css">@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
    0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(0, 0);     <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
    99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(100px, 0); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
}
</code></pre>
<p>translateだけのアニメーションでは、「100%」にしても不具合は発生しませんでしたので、<br>
組み合わせてアニメーションした場合に限り発生するようです。</p>
<h2>animation-fill-modeを指定すると、Android2系で動かない</h2>
<p><code>animation-fill-mode</code>は、Android2系がサポートされておらず、<br>
指定するとアニメーションが動かなくなります。</p>
<p><strong>動かない書き方</strong></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">background</span>: black;
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> forwards;
}
@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%       { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
}
</code></pre>
<p>この場合、<code>opacity</code>の初期値を予め設定しておき<code>forwards</code>を削除する事でAndroid2系でも動くようになります。<br>
初め<code>forwards</code>をサポートしてないブラウザは、単に無視されるのかなと思いましたが、指定されていただけで動かなくなりましたので、指定は削除する必要がありそうでした。</p>
<p><strong>動く書き方</strong></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">background</span>: black;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span>;
}
</code></pre>
<h2>擬似要素へのアニメーションがAndroid2,4系で動かない</h2>
<p><code>:before</code> や <code>:after</code> の擬似要素ですが、PCやiOSは動作確認出来ましたが、Android2,4系でも動かない端末がありました。<br>
現状、擬似要素へのアニメーションが必要な場合は、<code>span</code>タグなどで代替する必要がありそうです。</p>
<h2>transformの値を省略すると動かない</h2>
<p>例えば、「拡大しながら右にアニメーションしたい」という時に、<br>
下記のように0%時の<code>translateX()</code>を省略すると、Chromeなどでも動作確認出来ませんでした。</p>
<p><strong>動かない書き方</strong></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">background-color</span>: black;
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> infinite;
}
@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(0); }
  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(1) <span class="hljs-built_in">translateX</span>(100px); }
}
</code></pre>
<p>0%時のプロパティも省略せずに記述することで回避できます。</p>
<p><strong>動く書き方</strong></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">background-color</span>: black;
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> infinite;
}
@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(0) <span class="hljs-built_in">translateX</span>(0); }
  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(1) <span class="hljs-built_in">translateX</span>(100px); }
}
</code></pre>
<h2>animation-timing-function: steps()はAndroid2系がサポートしていない</h2>
<p>コマ送りのスプライト画像を準備して、<code>animation-timing-functionのsteps()</code>を使ってコマ送りアニメーションを実装する方法がありますが、Android2系でサポートしていない為、もし実装したい場合はJavaScriptなどを使用する必要がありそうです。</p>
<p>steps()の実装方法については下記が参考になります。<br>
<a href="http://www.webcreatorbox.com/tech/css-sprite-steps/">CSSスプライトとstepsを使ってアニメーション画像を作ろう</a></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(../images/heart.png);
  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">1450px</span> auto;
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> <span class="hljs-built_in">steps</span>(29) infinite;
}
@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%       { <span class="hljs-attribute">background-position</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; }
  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">background-position</span>: -<span class="hljs-number">1450px</span> <span class="hljs-number">0</span>; }
}
</code></pre>
<p>また、<code>animation-timing-function</code>の<code>cubic-bezier()</code>もAndroid2,4系で対応してない端末があるため(5系から正常に動作。)、スマホ案件では、<code>ease-in-out</code>や<code>linear</code>などの基本指定に留めておいたほうがよさそうです..。PCでは問題なさそうです。</p>
<h2>dispalayとopacityをtransitionさせる時の注意点</h2>
<p>例えば、最初は<code>display: none;</code>な要素を、class付与のタイミングで<code>display: block;</code>にすると同時にフェードインさせたい時に、<code>transition</code>でアニメーションさせる場合の注意点です。</p>
<p>下記のように実装すれば問題なさそうに見えますが、一瞬でboxが表示されてしまい意図した動作にならない場合があります。</p>
<p><strong>意図しない動作の書き方</strong></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">background</span>: black;
  <span class="hljs-attribute">display</span>: none;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">-webkit-transition</span>: opacity <span class="hljs-number">1s</span>;
}

<span class="hljs-selector-class">.box</span><span class="hljs-selector-class">.active</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}
</code></pre>
<p>こちらの対応策はいくつか方法がありそうですが、<br>
簡単なものだと<code>animation</code>の<code>keyframes</code>を使用することで回避出来ます。</p>
<p><strong>意図した動作の書き方</strong></p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">background</span>: black;
  <span class="hljs-attribute">display</span>: none;
}

<span class="hljs-selector-class">.box</span><span class="hljs-selector-class">.active</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span>;
}
@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }
  100% { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }
}
</code></pre>
<h2>translateとrotateを同時にアニメーションさせる場合は、記述順で動作が異なる</h2>
<p>こちら色々な端末で確認できましたが、<br>
例えば、回転させながら横に動かしたい時に、<br>
下記のような実装をすると意図した動作となります。</p>
<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;
  <span class="hljs-attribute">background-color</span>: black;
  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> infinite;
}
@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translateX</span>(0) <span class="hljs-built_in">rotate</span>(0); }
  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translateX</span>(100px) <span class="hljs-built_in">rotate</span>(180deg); }
}
</code></pre>
<p>ただ、下記のように<code>rotate</code>プロパティを先に記述してしまうと基準点が変わってしまい、<br>
意図した動作になりませんでした。</p>
<pre><code class="hljs language-css">@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {
  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">rotate</span>(0) <span class="hljs-built_in">translateX</span>(0) ; }
  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">rotate</span>(180deg) <span class="hljs-built_in">translateX</span>(100px); }
}
</code></pre>
<p><code>translate</code>と<code>rotate</code>を組み合わせる場合は、<code>translate</code>を先に書くようにしておくと良さそうです。</p>
<h2>3d系の指定をすると、Android2系でおかしな挙動となる場合がある</h2>
<p>端末のGPUを使用する為に、下記のようなプロパティを指定する事があるのですが</p>
<ul>
<li>transform: translate3d(0,0,0);</li>
<li>transform: translateZ(0);</li>
<li>backface-visibility: hidden;</li>
</ul>
<p>指定するとAndroid2系でいくつか不具合があがっているようです。</p>
<ul>
<li>フォーム関連要素がページ内にあった場合に、タップ位置が変わったりといった挙動がおかしくなる。</li>
<li>scale, rotate, skewのtransformプロパティが正常に動作しなくなる。</li>
<li>特定のCSSプロパティの上書きが反映されなくなる (positionなど)</li>
</ul>
<p>JIRAなどでAndroid2系のみおかしな挙動が起きた場合は、<br>
ページ内の3d系プロパティを疑うのも1つの解決方法となりそうです。</p>
<h2>使用できるプロパティ、使用出来ないプロパティを調べてみたところ...</h2>
<p>transform系以外のプロパティは、Android2系でも問題なく動作していそうです。<br>
例: <code>opacity, background-color, box-shadow</code>など。</p>
<p>transform系でAndroid2系も含めて動作確認出来たのは、<br>
<code>translateX, translateY, scaleX, scaleY, rotate, skewX, skewY, transform-origin, matrix</code>などでした。</p>
<p>Android2系で、動作確認出来なかったプロパティは、<br>
<code>translateZ, rotateX, rotateY, perspective</code>などの3d系プロパティが使えないようです。</p>
<p>Android2系までサポートしようとすると3D系のアニメーションは厳しい状況です。</p>
<p>2DのアニメーションであればAndroid2系含めて動作しますので(複雑でたくさん動かしたい場合はパフォーマンス的に厳しそうですが..)、様々な場面で検討していくと良さそうです。</p>
<h2>不具合への対策まとめ</h2>
<p>・<code>keyframes</code>は<code>「100%」→「99.9%, to」</code>と書く。<br>
・<code>animation-fill-mode</code>(bothやforwardsなど)は、Android2系で使えないので注意する。初期値を予め設定しておくと良い。<br>
・<code>cubic-bezier()</code>は、Android2系では使えない。<br>
・疑似要素でアニメーションが必要な場合は、<code>span</code>タグなどで代替する。<br>
・<code>keyframes</code>内の、各％のプロパティは省略せずに記述する。<br>
・<code>animation-timing-function: steps();</code>はAndroid2系がサポートしていない<br>
・<code>dispalay</code>と<code>opacity</code>を併用したアニメーションでは、<code>keyframes</code>を使用すると良い。<br>
・<code>translate</code>と<code>rotate</code>を同時にアニメーションさせる場合は、<code>translate</code>を先に記述する。<br>
・3d系のプロパティ(<code>translate3d, backface-visibility: hidden;</code>)の指定がある場合は、Android2系で不具合が起きる可能性があることを知っておく。</p>
<p>以上になります。<br>
間違ってるところなどありましたら、ご連絡頂けると有難いです。<br>
今後のCSSアニメーション実装の参考にして頂ければと思います。</p>
</section>
</div> <!----></div> <footer data-v-7bad5fd4 data-v-2504b6de><section class="container" data-v-7bad5fd4><h2 data-v-7bad5fd4>Author</h2> <div class="box" data-v-7bad5fd4><img width="120" height="120" src="/_nuxt/img/5bcc242.png" alt="Naoki Otsu" class="profile" data-v-7bad5fd4> <div class="info" data-v-7bad5fd4><h3 data-v-7bad5fd4>Naoki Otsu</h3> <p data-v-7bad5fd4>
          Front-End Engineer.<br data-v-7bad5fd4>
          Vue, React, React Native, Firebase, GraqhQL, etc..<br data-v-7bad5fd4>
          フロントエンドを中心に発信しています。お気軽にフォローくださいませ👍
          <!----></p> <ul data-v-7bad5fd4><li data-v-7bad5fd4><a href="/profile/" data-v-2504b6de data-v-7bad5fd4><img src="/_nuxt/img/f31a284.png" width="24" height="24" alt="Profile" data-v-2504b6de data-v-7bad5fd4></a> <a href="/profile/" data-v-2504b6de data-v-7bad5fd4>Profile</a></li> <li data-v-7bad5fd4><a href="https://twitter.com/melo15" target="_blank" rel="noopener" data-v-7bad5fd4><img src="/_nuxt/img/f564668.svg" width="24" height="24" alt="Naoki Otsu Twitter" data-v-7bad5fd4></a> <a href="https://twitter.com/melo15" target="_blank" rel="noopener" data-v-7bad5fd4>@melo15</a></li> <li data-v-7bad5fd4><a href="https://github.com/NaokiOtsu" target="_blank" rel="noopener" data-v-7bad5fd4><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAn1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8Kd3m4AAAANHRSTlMAD/rcXveZCCrp5M2+TfNuZa+ffXQgFe3Hq6KINxrf16aCeVJBMgrUjT7okiQdBQS2j0hYJ20qHAAAApZJREFUWMPN1ttyqjAUBuAfgoAWoSoqVfB8aLXVHtb7P9vuMDSs1ATi7Jt+d87EDMnK+hOYjL354HiKieLTcTD3xrjLzl/QLwt/B0uTdY+0eusJ2r2dO2TUOb+h2SWNqVGcXtBgv6RWyz2MEpcsuAn0giey9BRAw8nIWuZo/v9Ad3i4meGQ0V2yA1QDutMAipTuloLJZf12e2/VMR7ElbffyWrmrIBCbk65n5spaUw35c7JzRZ1MUdy0HNVkjMRdaPhPE2SdD6MukR0rjb+WQ4eydavv9mTh9obq+kgD7BXr+hniE/SJ1p9kuRXDcw6oI9WfdYVb3xRpUe0eiRSt+zSJf5RrXyqdS/yk3gZzWQZ+ZJnvNVztMp5aMwAnNjvESyMqHYCQh67ASwEPLRDZVM3sLJRyvbBfr3CyivVPvDOVgBLbA3vECRFsBSRJNDlNbG0Yj0Olh5DWBqyjIE55jhzgIL+bw+IL0HAkmBL4JvoBrASuKwfleZ6gZUXpX35jTqHlTm/Z7Hm7yBY4e+ntZonX7DwpSbKhBhxQKvDgpgJiyj7TFQjcE3cyCaP+BaUkcT5ARoEPilCfMtIIfow2gpSZOyyi176fnWsj8lYG0TpkiR+lV57ZRyF30PkiMUw7bO1ONvRqqd5+175ZRV/TzcRLF4MCaC5CK9H+Tuvo8YB4+ieHMerfN1XrRmyKn1A8Uy3djeH4511Sl/7KjAduoOoy5rPxFQ8eQEUY5K0xz6Mq+Y0ceiXOIRiS6Wt9QRb/cOjs22bwPyUSaqIyW0mSKDhuVVORoNBNnUaJnA9Q1jy11LDBF1j+BaRzQRRAbMkbpsgTtCo+GmbApyMzmGBNuGs3MyJZgJ3FsJGsVnS6vZNsNwU+Iv+AYLIWYBESwRlAAAAAElFTkSuQmCC" width="24" height="24" alt="Naoki Otsu Github" data-v-7bad5fd4></a> <a href="https://github.com/NaokiOtsu" target="_blank" rel="noopener" data-v-7bad5fd4>NaokiOtsu</a></li> <li data-v-7bad5fd4><a href="https://www.instagram.com/n.otsu1029/" target="_blank" rel="noopener" data-v-7bad5fd4><img src="/_nuxt/img/7811e1e.svg" width="24" height="24" alt="Naoki Otsu Instagram" data-v-7bad5fd4></a> <a href="https://www.instagram.com/n.otsu1029/" target="_blank" rel="noopener" data-v-7bad5fd4>n.otsu1029</a></li></ul></div></div> <address data-v-7bad5fd4><small data-v-7bad5fd4>Naoki Otsu © 2019</small></address></section></footer></div></div></div><script>window.__NUXT__=function(n){return n.attributes={title:"CSSアニメーションのスマホ(iOS/Android)で起きる不具合/バグ",date:new Date(1480896e6)},n.body="普段のスマホのコーディングでは、かなり多くのユーザーを抱えたWeb開発に携わらせて頂いていますが、\nそうするとCSSアニメーションで「動かない」などの声を頂くことも多くあり、\nどんな書き方をすると、どの端末で動かない事があるのか。\nまたその対応策など、自分の遭遇したもの中心に記載しておこうと思います。\n\n## transformが含まれた複数プロパティをアニメーションさせた時にAndroid2系で動かない\n\n`「transform + 任意のプロパティ」`をアニメーションさせた時に、\nkeyframesの指定が 0% → 100% となっているとAndroid2系で動きません。\nよくある要件としては、`「移動させながらopacityを1にする」「縮小しながらopacityを0にする」`などでしょうか。\n\n**動かない書き方**\n\n```css\n.test {\n  -webkit-animation: hoge 2s infinite;\n}\n@-webkit-keyframes hoge {\n  0%   { -webkit-transform: translate(0, 0);     opacity: 0; }\n  100% { -webkit-transform: translate(100px, 0); opacity: 1; }\n}\n```\n\n結論、「100%」→`「99.9%,to」`と書くと動きますので、\nkeyframesの指定は`「99.9%,to」`の書き方で統一しておくと良さそうです。\n\n**動く書き方**\n\n```css\n@-webkit-keyframes hoge {\n    0%       { -webkit-transform: translate(0, 0);     opacity: 0; }\n    99.9%,to { -webkit-transform: translate(100px, 0); opacity: 1; }\n}\n```\n\ntranslateだけのアニメーションでは、「100%」にしても不具合は発生しませんでしたので、\n組み合わせてアニメーションした場合に限り発生するようです。\n\n## animation-fill-modeを指定すると、Android2系で動かない\n\n`animation-fill-mode`は、Android2系がサポートされておらず、\n指定するとアニメーションが動かなくなります。\n\n**動かない書き方**\n\n```css\n.box {\n  width: 50px;\n  height: 50px;\n  background: black;\n  -webkit-animation: hoge 1s forwards;\n}\n@-webkit-keyframes hoge {\n  0%       { opacity: 1; }\n  99.9%,to { opacity: 0; }\n}\n```\nこの場合、`opacity`の初期値を予め設定しておき`forwards`を削除する事でAndroid2系でも動くようになります。\n初め`forwards`をサポートしてないブラウザは、単に無視されるのかなと思いましたが、指定されていただけで動かなくなりましたので、指定は削除する必要がありそうでした。\n\n**動く書き方**\n\n```css\n.box {\n  width: 50px;\n  height: 50px;\n  background: black;\n  opacity: 0;\n  -webkit-animation: hoge 1s;\n}\n```\n\n## 擬似要素へのアニメーションがAndroid2,4系で動かない\n\n`:before` や `:after` の擬似要素ですが、PCやiOSは動作確認出来ましたが、Android2,4系でも動かない端末がありました。\n現状、擬似要素へのアニメーションが必要な場合は、`span`タグなどで代替する必要がありそうです。\n\n## transformの値を省略すると動かない\n\n例えば、「拡大しながら右にアニメーションしたい」という時に、\n下記のように0%時の`translateX()`を省略すると、Chromeなどでも動作確認出来ませんでした。\n\n**動かない書き方**\n\n```css\n.box {\n  width: 50px;\n  height: 50px;\n  background-color: black;\n  -webkit-animation: hoge 1s infinite;\n}\n@-webkit-keyframes hoge {\n  0%       { -webkit-transform: scale(0); }\n  99.9%,to { -webkit-transform: scale(1) translateX(100px); }\n}\n```\n\n0%時のプロパティも省略せずに記述することで回避できます。\n\n**動く書き方**\n\n```css\n.box {\n  width: 50px;\n  height: 50px;\n  background-color: black;\n  -webkit-animation: hoge 1s infinite;\n}\n@-webkit-keyframes hoge {\n  0%       { -webkit-transform: scale(0) translateX(0); }\n  99.9%,to { -webkit-transform: scale(1) translateX(100px); }\n}\n```\n\n## animation-timing-function: steps()はAndroid2系がサポートしていない\n\nコマ送りのスプライト画像を準備して、`animation-timing-functionのsteps()`を使ってコマ送りアニメーションを実装する方法がありますが、Android2系でサポートしていない為、もし実装したい場合はJavaScriptなどを使用する必要がありそうです。\n\nsteps()の実装方法については下記が参考になります。\n[CSSスプライトとstepsを使ってアニメーション画像を作ろう](http://www.webcreatorbox.com/tech/css-sprite-steps/)\n\n```css\n.box {\n  width: 50px;\n  height: 50px;\n  background-image: url(../images/heart.png);\n  background-size: 1450px auto;\n  -webkit-animation: hoge 1s steps(29) infinite;\n}\n@-webkit-keyframes hoge {\n  0%       { background-position: 0 0; }\n  99.9%,to { background-position: -1450px 0; }\n}\n```\n\nまた、`animation-timing-function`の`cubic-bezier()`もAndroid2,4系で対応してない端末があるため(5系から正常に動作。)、スマホ案件では、`ease-in-out`や`linear`などの基本指定に留めておいたほうがよさそうです..。PCでは問題なさそうです。\n\n## dispalayとopacityをtransitionさせる時の注意点\n\n例えば、最初は`display: none;`な要素を、class付与のタイミングで`display: block;`にすると同時にフェードインさせたい時に、`transition`でアニメーションさせる場合の注意点です。\n\n下記のように実装すれば問題なさそうに見えますが、一瞬でboxが表示されてしまい意図した動作にならない場合があります。\n\n**意図しない動作の書き方**\n\n```css\n.box {\n  width: 50px;\n  height: 50px;\n  background: black;\n  display: none;\n  opacity: 0;\n  -webkit-transition: opacity 1s;\n}\n\n.box.active {\n  display: block;\n  opacity: 1;\n}\n```\n\nこちらの対応策はいくつか方法がありそうですが、\n簡単なものだと`animation`の`keyframes`を使用することで回避出来ます。\n\n**意図した動作の書き方**\n\n```css\n.box {\n  width: 50px;\n  height: 50px;\n  background: black;\n  display: none;\n}\n\n.box.active {\n  display: block;\n  opacity: 1;\n  -webkit-animation: hoge 1s;\n}\n@-webkit-keyframes hoge {\n  0%   { opacity: 0; }\n  100% { opacity: 1; }\n}\n```\n\n## translateとrotateを同時にアニメーションさせる場合は、記述順で動作が異なる\n\nこちら色々な端末で確認できましたが、\n例えば、回転させながら横に動かしたい時に、\n下記のような実装をすると意図した動作となります。\n\n```css\n.box {\n  width: 100px;\n  height: 100px;\n  background-color: black;\n  -webkit-animation: hoge 1s infinite;\n}\n@-webkit-keyframes hoge {\n  0%       { -webkit-transform: translateX(0) rotate(0); }\n  99.9%,to { -webkit-transform: translateX(100px) rotate(180deg); }\n}\n```\n\nただ、下記のように`rotate`プロパティを先に記述してしまうと基準点が変わってしまい、\n意図した動作になりませんでした。\n\n```css\n@-webkit-keyframes hoge {\n  0%       { -webkit-transform: rotate(0) translateX(0) ; }\n  99.9%,to { -webkit-transform: rotate(180deg) translateX(100px); }\n}\n```\n\n`translate`と`rotate`を組み合わせる場合は、`translate`を先に書くようにしておくと良さそうです。\n\n\n## 3d系の指定をすると、Android2系でおかしな挙動となる場合がある\n\n端末のGPUを使用する為に、下記のようなプロパティを指定する事があるのですが\n* transform: translate3d(0,0,0);\n* transform: translateZ(0);\n* backface-visibility: hidden;\n\n指定するとAndroid2系でいくつか不具合があがっているようです。\n* フォーム関連要素がページ内にあった場合に、タップ位置が変わったりといった挙動がおかしくなる。\n* scale, rotate, skewのtransformプロパティが正常に動作しなくなる。\n* 特定のCSSプロパティの上書きが反映されなくなる (positionなど)\n\nJIRAなどでAndroid2系のみおかしな挙動が起きた場合は、\nページ内の3d系プロパティを疑うのも1つの解決方法となりそうです。\n\n\n## 使用できるプロパティ、使用出来ないプロパティを調べてみたところ...\n\ntransform系以外のプロパティは、Android2系でも問題なく動作していそうです。\n例: `opacity, background-color, box-shadow`など。\n\ntransform系でAndroid2系も含めて動作確認出来たのは、\n`translateX, translateY, scaleX, scaleY, rotate, skewX, skewY, transform-origin, matrix`などでした。\n\nAndroid2系で、動作確認出来なかったプロパティは、\n`translateZ, rotateX, rotateY, perspective`などの3d系プロパティが使えないようです。\n\nAndroid2系までサポートしようとすると3D系のアニメーションは厳しい状況です。\n\n2DのアニメーションであればAndroid2系含めて動作しますので(複雑でたくさん動かしたい場合はパフォーマンス的に厳しそうですが..)、様々な場面で検討していくと良さそうです。\n\n\n## 不具合への対策まとめ\n\n・`keyframes`は`「100%」→「99.9%, to」`と書く。\n・`animation-fill-mode`(bothやforwardsなど)は、Android2系で使えないので注意する。初期値を予め設定しておくと良い。\n・`cubic-bezier()`は、Android2系では使えない。\n・疑似要素でアニメーションが必要な場合は、`span`タグなどで代替する。\n・`keyframes`内の、各％のプロパティは省略せずに記述する。\n・`animation-timing-function: steps();`はAndroid2系がサポートしていない\n・`dispalay`と`opacity`を併用したアニメーションでは、`keyframes`を使用すると良い。\n・`translate`と`rotate`を同時にアニメーションさせる場合は、`translate`を先に記述する。\n・3d系のプロパティ(`translate3d, backface-visibility: hidden;`)の指定がある場合は、Android2系で不具合が起きる可能性があることを知っておく。\n\n以上になります。\n間違ってるところなどありましたら、ご連絡頂けると有難いです。\n今後のCSSアニメーション実装の参考にして頂ければと思います。\n",n.frontmatter="title: CSSアニメーションのスマホ(iOS/Android)で起きる不具合/バグ\ndate: 2016-12-05",n.fileName="2016-12-05-css-animation-bug",{layout:"default",data:[{content:'<section><p>普段のスマホのコーディングでは、かなり多くのユーザーを抱えたWeb開発に携わらせて頂いていますが、<br>\nそうするとCSSアニメーションで「動かない」などの声を頂くことも多くあり、<br>\nどんな書き方をすると、どの端末で動かない事があるのか。<br>\nまたその対応策など、自分の遭遇したもの中心に記載しておこうと思います。</p>\n<h2>transformが含まれた複数プロパティをアニメーションさせた時にAndroid2系で動かない</h2>\n<p><code>「transform + 任意のプロパティ」</code>をアニメーションさせた時に、<br>\nkeyframesの指定が 0% → 100% となっているとAndroid2系で動きません。<br>\nよくある要件としては、<code>「移動させながらopacityを1にする」「縮小しながらopacityを0にする」</code>などでしょうか。</p>\n<p><strong>動かない書き方</strong></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.test</span> {\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">2s</span> infinite;\n}\n@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%   { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(0, 0);     <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }\n  100% { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(100px, 0); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }\n}\n</code></pre>\n<p>結論、「100%」→<code>「99.9%,to」</code>と書くと動きますので、<br>\nkeyframesの指定は<code>「99.9%,to」</code>の書き方で統一しておくと良さそうです。</p>\n<p><strong>動く書き方</strong></p>\n<pre><code class="hljs language-css">@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n    0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(0, 0);     <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }\n    99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translate</span>(100px, 0); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }\n}\n</code></pre>\n<p>translateだけのアニメーションでは、「100%」にしても不具合は発生しませんでしたので、<br>\n組み合わせてアニメーションした場合に限り発生するようです。</p>\n<h2>animation-fill-modeを指定すると、Android2系で動かない</h2>\n<p><code>animation-fill-mode</code>は、Android2系がサポートされておらず、<br>\n指定するとアニメーションが動かなくなります。</p>\n<p><strong>動かない書き方</strong></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">background</span>: black;\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> forwards;\n}\n@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%       { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }\n  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }\n}\n</code></pre>\n<p>この場合、<code>opacity</code>の初期値を予め設定しておき<code>forwards</code>を削除する事でAndroid2系でも動くようになります。<br>\n初め<code>forwards</code>をサポートしてないブラウザは、単に無視されるのかなと思いましたが、指定されていただけで動かなくなりましたので、指定は削除する必要がありそうでした。</p>\n<p><strong>動く書き方</strong></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">background</span>: black;\n  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span>;\n}\n</code></pre>\n<h2>擬似要素へのアニメーションがAndroid2,4系で動かない</h2>\n<p><code>:before</code> や <code>:after</code> の擬似要素ですが、PCやiOSは動作確認出来ましたが、Android2,4系でも動かない端末がありました。<br>\n現状、擬似要素へのアニメーションが必要な場合は、<code>span</code>タグなどで代替する必要がありそうです。</p>\n<h2>transformの値を省略すると動かない</h2>\n<p>例えば、「拡大しながら右にアニメーションしたい」という時に、<br>\n下記のように0%時の<code>translateX()</code>を省略すると、Chromeなどでも動作確認出来ませんでした。</p>\n<p><strong>動かない書き方</strong></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">background-color</span>: black;\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> infinite;\n}\n@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(0); }\n  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(1) <span class="hljs-built_in">translateX</span>(100px); }\n}\n</code></pre>\n<p>0%時のプロパティも省略せずに記述することで回避できます。</p>\n<p><strong>動く書き方</strong></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">background-color</span>: black;\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> infinite;\n}\n@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(0) <span class="hljs-built_in">translateX</span>(0); }\n  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">scale</span>(1) <span class="hljs-built_in">translateX</span>(100px); }\n}\n</code></pre>\n<h2>animation-timing-function: steps()はAndroid2系がサポートしていない</h2>\n<p>コマ送りのスプライト画像を準備して、<code>animation-timing-functionのsteps()</code>を使ってコマ送りアニメーションを実装する方法がありますが、Android2系でサポートしていない為、もし実装したい場合はJavaScriptなどを使用する必要がありそうです。</p>\n<p>steps()の実装方法については下記が参考になります。<br>\n<a href="http://www.webcreatorbox.com/tech/css-sprite-steps/">CSSスプライトとstepsを使ってアニメーション画像を作ろう</a></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(../images/heart.png);\n  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">1450px</span> auto;\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> <span class="hljs-built_in">steps</span>(29) infinite;\n}\n@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%       { <span class="hljs-attribute">background-position</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>; }\n  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">background-position</span>: -<span class="hljs-number">1450px</span> <span class="hljs-number">0</span>; }\n}\n</code></pre>\n<p>また、<code>animation-timing-function</code>の<code>cubic-bezier()</code>もAndroid2,4系で対応してない端末があるため(5系から正常に動作。)、スマホ案件では、<code>ease-in-out</code>や<code>linear</code>などの基本指定に留めておいたほうがよさそうです..。PCでは問題なさそうです。</p>\n<h2>dispalayとopacityをtransitionさせる時の注意点</h2>\n<p>例えば、最初は<code>display: none;</code>な要素を、class付与のタイミングで<code>display: block;</code>にすると同時にフェードインさせたい時に、<code>transition</code>でアニメーションさせる場合の注意点です。</p>\n<p>下記のように実装すれば問題なさそうに見えますが、一瞬でboxが表示されてしまい意図した動作にならない場合があります。</p>\n<p><strong>意図しない動作の書き方</strong></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">background</span>: black;\n  <span class="hljs-attribute">display</span>: none;\n  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;\n  <span class="hljs-attribute">-webkit-transition</span>: opacity <span class="hljs-number">1s</span>;\n}\n\n<span class="hljs-selector-class">.box</span><span class="hljs-selector-class">.active</span> {\n  <span class="hljs-attribute">display</span>: block;\n  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;\n}\n</code></pre>\n<p>こちらの対応策はいくつか方法がありそうですが、<br>\n簡単なものだと<code>animation</code>の<code>keyframes</code>を使用することで回避出来ます。</p>\n<p><strong>意図した動作の書き方</strong></p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;\n  <span class="hljs-attribute">background</span>: black;\n  <span class="hljs-attribute">display</span>: none;\n}\n\n<span class="hljs-selector-class">.box</span><span class="hljs-selector-class">.active</span> {\n  <span class="hljs-attribute">display</span>: block;\n  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span>;\n}\n@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%   { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; }\n  100% { <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>; }\n}\n</code></pre>\n<h2>translateとrotateを同時にアニメーションさせる場合は、記述順で動作が異なる</h2>\n<p>こちら色々な端末で確認できましたが、<br>\n例えば、回転させながら横に動かしたい時に、<br>\n下記のような実装をすると意図した動作となります。</p>\n<pre><code class="hljs language-css"><span class="hljs-selector-class">.box</span> {\n  <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;\n  <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;\n  <span class="hljs-attribute">background-color</span>: black;\n  <span class="hljs-attribute">-webkit-animation</span>: hoge <span class="hljs-number">1s</span> infinite;\n}\n@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translateX</span>(0) <span class="hljs-built_in">rotate</span>(0); }\n  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">translateX</span>(100px) <span class="hljs-built_in">rotate</span>(180deg); }\n}\n</code></pre>\n<p>ただ、下記のように<code>rotate</code>プロパティを先に記述してしまうと基準点が変わってしまい、<br>\n意図した動作になりませんでした。</p>\n<pre><code class="hljs language-css">@-<span class="hljs-keyword">webkit</span>-<span class="hljs-keyword">keyframes</span> hoge {\n  0%       { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">rotate</span>(0) <span class="hljs-built_in">translateX</span>(0) ; }\n  99<span class="hljs-selector-class">.9</span>%,<span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">-webkit-transform</span>: <span class="hljs-built_in">rotate</span>(180deg) <span class="hljs-built_in">translateX</span>(100px); }\n}\n</code></pre>\n<p><code>translate</code>と<code>rotate</code>を組み合わせる場合は、<code>translate</code>を先に書くようにしておくと良さそうです。</p>\n<h2>3d系の指定をすると、Android2系でおかしな挙動となる場合がある</h2>\n<p>端末のGPUを使用する為に、下記のようなプロパティを指定する事があるのですが</p>\n<ul>\n<li>transform: translate3d(0,0,0);</li>\n<li>transform: translateZ(0);</li>\n<li>backface-visibility: hidden;</li>\n</ul>\n<p>指定するとAndroid2系でいくつか不具合があがっているようです。</p>\n<ul>\n<li>フォーム関連要素がページ内にあった場合に、タップ位置が変わったりといった挙動がおかしくなる。</li>\n<li>scale, rotate, skewのtransformプロパティが正常に動作しなくなる。</li>\n<li>特定のCSSプロパティの上書きが反映されなくなる (positionなど)</li>\n</ul>\n<p>JIRAなどでAndroid2系のみおかしな挙動が起きた場合は、<br>\nページ内の3d系プロパティを疑うのも1つの解決方法となりそうです。</p>\n<h2>使用できるプロパティ、使用出来ないプロパティを調べてみたところ...</h2>\n<p>transform系以外のプロパティは、Android2系でも問題なく動作していそうです。<br>\n例: <code>opacity, background-color, box-shadow</code>など。</p>\n<p>transform系でAndroid2系も含めて動作確認出来たのは、<br>\n<code>translateX, translateY, scaleX, scaleY, rotate, skewX, skewY, transform-origin, matrix</code>などでした。</p>\n<p>Android2系で、動作確認出来なかったプロパティは、<br>\n<code>translateZ, rotateX, rotateY, perspective</code>などの3d系プロパティが使えないようです。</p>\n<p>Android2系までサポートしようとすると3D系のアニメーションは厳しい状況です。</p>\n<p>2DのアニメーションであればAndroid2系含めて動作しますので(複雑でたくさん動かしたい場合はパフォーマンス的に厳しそうですが..)、様々な場面で検討していくと良さそうです。</p>\n<h2>不具合への対策まとめ</h2>\n<p>・<code>keyframes</code>は<code>「100%」→「99.9%, to」</code>と書く。<br>\n・<code>animation-fill-mode</code>(bothやforwardsなど)は、Android2系で使えないので注意する。初期値を予め設定しておくと良い。<br>\n・<code>cubic-bezier()</code>は、Android2系では使えない。<br>\n・疑似要素でアニメーションが必要な場合は、<code>span</code>タグなどで代替する。<br>\n・<code>keyframes</code>内の、各％のプロパティは省略せずに記述する。<br>\n・<code>animation-timing-function: steps();</code>はAndroid2系がサポートしていない<br>\n・<code>dispalay</code>と<code>opacity</code>を併用したアニメーションでは、<code>keyframes</code>を使用すると良い。<br>\n・<code>translate</code>と<code>rotate</code>を同時にアニメーションさせる場合は、<code>translate</code>を先に記述する。<br>\n・3d系のプロパティ(<code>translate3d, backface-visibility: hidden;</code>)の指定がある場合は、Android2系で不具合が起きる可能性があることを知っておく。</p>\n<p>以上になります。<br>\n間違ってるところなどありましたら、ご連絡頂けると有難いです。<br>\n今後のCSSアニメーション実装の参考にして頂ければと思います。</p>\n</section>\n'}],error:null,state:{posts:[{attributes:{title:"シリコンバレーや中国から学ぶということ",date:new Date(15585696e5),image:"https://blog.naoki-otsu.com/images/2019-05-23/og.png"},body:"何気なく、日曜日いつものサンデーモーニングからワイドナショーの流れでテレビを見ていたら、陸上の末續慎吾選手が出演されていた。\n北京オリンピック男子4×100mリレーで銀メダルを獲得された陸上界では超有名な方。\n陸上100mで2人目の9秒台が出た!、ということで解説者として出演されていた感じだ。\n\nその中でコメンテーターから\n`「なぜ最近100mで9秒台を出す選手が増えてるのか？」`\nという質問があり、これに対し末續さんは\n`「世界中から早く走る為のデータが簡単に手に入るようになったから」`\nと即答されていた。\n\n即答されるということは、常に陸上界に身を寄せていて普段からそう感じる事が多いという事だろうし、たぶんそれが事実なんだと思う。\n\nこれまでの自分の100mへの認識は、生まれつきの才能、つまり体格やバネの強さとかそういうもので全てが決まる競技だと思っていた。\nでも末續さんは、`早くなる為の技術を世界中から取り込んで練習に活かせば世界のトップ選手とも張り合えるようになる`とおっしゃっていたのだ。\n\nここで自分の仕事を見つめ直すことになる。\n自分は、ReactやVueなど使っているものは世界中で使われている技術を使ってはいるものの、ユーザーに良いものを届ける為の技術や仕組みなど、`ユーザーが本当に求めているものを作る為の技術を海外の企業(シリコンバレーや中国など)から学ぶ`ということがほとんど出来てないんじゃないか。\n\n海外の有名サービスを使っていると、ワクワク感とかこれはハマるわって感じる事が多い。\nそういうものを作れるようになるには、根底にはReactやVueなどの技術はありつつも、`ハマるポイントやワクワク感をユーザーに感じてもらう為の技術` ともいうべきか、そういうものを作リ出す技術をそれを実際に生み出しているところから吸収するようにしないと、と思ったりした。\n",frontmatter:"title: シリコンバレーや中国から学ぶということ\ndate: 2019-05-23\nimage: https://blog.naoki-otsu.com/images/2019-05-23/og.png",fileName:"2019-05-23-suetsugu-magic"},{attributes:{title:"React Native + FirebaseでiOS & Androidアプリを開発してリリースしました",date:new Date(1558224e6),image:"https://blog.naoki-otsu.com/images/2019-05-19/og.png"},body:'React Native(Expo) + Firebaseで`「TouchLife」`という家計簿アプリを友人と2人で開発して、iOS & Androidアプリとしてリリースしました。\n\n<div style="display: flex; justify-content: center;  align-items: center; margin-top: 42px;">\n  <div>\n    <img style="width: 100px; margin: 0; padding: 0; border-radius: 16px; box-shadow: 0 0 3px rgba(0,0,0,0.5)" src="/images/2019-05-19/touchlife.png">\n  </div>\n  <div style="margin-left: 20px;">\n    <div style="margin-top: 4px;">\n      <a style="" href="https://itunes.apple.com/app/id1460375602" target="_blank"><img src="/images/2019-05-19/Download_on_the_App_Store_Badge_JP_RGB_blk_100317.svg" style="width: 140px; margin: 0;"></a>\n    </div>\n    <div style="margin-top: 6px;">\n      <a style="" href="https://play.google.com/store/apps/details?id=jp.touchlife" target="_blank"><img src="/images/2019-05-19/google-play-badge.png" style="width: 120px; margin: 0 0 0 10px; transform: scale(1.32)"></a>\n    </div>\n  </div>\n</div>\n\n# TouchLifeとは\n\n<div style="display: flex; overflow-x: scroll; -webkit-overflow-scrolling: touch;">\n  <div>\n    <img src="/images/2019-05-19/capture3.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture1.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture4.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture5.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture7.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture6.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture8.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture9.png" class="touchlife-img">\n  </div>\n  <div>\n    <img src="/images/2019-05-19/capture10.png" class="touchlife-img">\n  </div>\n</div>\n\n簡単にいうと家計簿アプリです。\n`お金をちゃんと把握しようとすると出てくる面倒さを解決`する為に作りました。\n\n通常の家計簿は記録するのがメインになると思いますが、そこから一歩踏み込んで、今月使ったお金が前月と比べてプラスなのかマイナスなのか、食費や交際費など細かい勘定科目で見た時にリアルな数字としてはどうなのか、を計算して分析するという特徴があります。\n\n特に`給料日から今日までに使ったお金が前月のまったく同じ日と比べてどうなのか`を計算する同日対比の機能が一番の特徴です。\n\nこれからちゃんとお金を把握していきたいなと思っている方に届けば良いなという思いで、リクルートで働いてる友人と遠隔でやりとりしつつ2人で開発しました。\n\n普段は自分もエンジニアとして会社に所属しているので、その合間で開発を進めていった感じです。友人が企画 + デザイン、自分がエンジニアリングを担当。\n\n以下、技術メインで紹介できればと思います。\n\n# 使った技術\n\n- React Native(Expo)\n- Firebase\n- React Navigation\n- redux + thunk\n- Sentry\n- Google Analytics\n\n# React Native(Expo)\n\n<img src="/images/2019-05-19/react_native.png" style="width: 288px">\n<img src="/images/2019-05-19/expo.png" style="    width: 130px; margin-bottom: 40px; margin-left: 15px;">\n\nメインは[React Native](https://facebook.github.io/react-native/) + [Expo](https://expo.io/)です。\n最初はExpoは使わずReact Nativeのみで開発していましたが、React Nativeのバージョンアップに追従させる時や何か特別なことを入れようとする度に赤いエラー画面になってしまい、機能の実装よりそのエラーの解決に労力が割かれてる感がずっと気になっていました。(アプリ開発経験が豊富じゃないと辛い印象だった。React Native開発の経験値不足もある。)\n\nこれはいかんということでExpoで1から作り直したのですが、この開発体感がびっくりするぐらい良かった。\n基本Expoのレール上の実装になるので機能はExpoで提供されているものに制限されるデメリットはありますが、その分エラーになる事がほとんどなくなり、結果的にそれまでの2倍ぐらいの開発スピードになったと思います。\n今回のアプリの要件がExpoの提供範囲内で十分開発可能だったこともExpo移行の理由でした。\n\nまた今回は遠隔でやりとりしながらの開発だったんですが、Expoの場合、Expo ClientのiPhoneアプリを通じて[遠隔地でもビルドなしでiPhoneの実機で確認可能](https://docs.expo.io/versions/latest/workflow/how-expo-works/#serving-an-expo-project-for-local-development)で、これが大変役に立ちました。\n\n# Firebase\n\n<img src="/images/2019-05-19/firebase.png" style="width: 218px">\n\nユーザー認証やデータベースへの保存の仕組みが必要で、認証の仕組みが予め備わっていてモバイルアプリに特化している[Firebase](https://firebase.google.com/)を使う事にしました。\n主に使った機能は、`Authentication、Firestore、Functions, Hosting`の4つです。\n\n# Authentication\n- メールアドレス/パスワード認証\n- Facebook/Google認証\n\nの2つを実装しました。\n特にユーザーの入力したパスワードは`Firebase側のみで管理されて自前で管理しなくてよくなる`(開発者も知る事ができない)ので、よりセキュア + DBにencryptして保存のような実装もいらなくなるので、その分メインの開発に時間を割く事が出来ました。\n\n# Firestore\n\nユーザー情報とそれに紐づく支出、収入のデータのDB保存が必要だったので、Firestoreを使いました。\n`usersコレクションにユーザーごとのデータ、その中に支出、収入のサブコレクションを持つ構成`にしました。\nリリースしたばかりなので無料の範囲内で利用できています。\n\n# Functions\nお問い合わせすると、その内容をGmailに送信する必要があったのでFunctionsを使って実装しました。\n内部で[Nodemailer](https://www.nodemailer.com/)を使っています。下記の記事が非常に参考になりました。\n[Vue.js + Firebase functionsでお問い合わせフォームを作成する](https://qiita.com/ryo2132/items/7cdd6c86dd418095f74a)\n\n# Hosting\n主に利用規約、プライバシーポリシーの静的ページの為に使いました。\nExpoのWebViewを使って、アプリ内から参照するようにしています。\nまたメール認証した後にアプリに戻すリダイレクトが必要だったため、リダイレクト専用のhtmlファイルも配置しています。\n\nゆくゆくはランディングページにも利用する事になりそうです。\nその際は現行のフロントエンドのベストプラクティスが詰まってる[Nuxt](https://ja.nuxtjs.org/)の[generate](https://ja.nuxtjs.org/api/configuration-generate)で作るのが良いかなと思ってます。(このブログもnuxt generate + markdownです)\n\n# React Navigation\nルーティングとナビゲーションは[React Navigation](https://github.com/react-navigation/react-navigation)で実装しました。\n最初は[react-native-router-flux](https://github.com/aksonov/react-native-router-flux)を使っていましたが、このモジュール自体がReact Navigationをベースに作られていてReact Navigationの[ドキュメント](https://reactnavigation.org/docs/en/getting-started.html)がしっかり準備されていたので、途中からReact Navigationに変更しました。\nこれから始めるならReact Navigationで良い印象です。\n\n# redux + thunk\n状態管理は[react-redux](https://github.com/reduxjs/react-redux)\nまたDBへのアクセス時に非同期通信が必要なので、ミドルウェアは[redux-thunk](https://github.com/reduxjs/redux-thunk)を入れました。\n[redux-saga](https://github.com/redux-saga/redux-saga)の選択肢もありましたが、thunkの方がなじみがあったのでこちらにしました。\n\n# Sentry\n\n<img src="/images/2019-05-19/sentry.png" style="width: 228px">\n\nバグ検知はExpoで公式にサポートされている[Sentry](https://sentry.io/welcome/)を導入。\nユーザーの端末でエラーが起きるとGmail, Slackに通知が飛ぶようになっています。\n[sentry-expo](https://github.com/expo/sentry-expo)を使っていて、今のところ無料範囲内で利用できています。\n\n# Google Analytics\nアプリのインストール数などはApp Store Connectのアナリティクスでも確認できますが、具体的な時間帯や詳しい情報も欲しかったのでGoogle Analyticsを導入しました。\n[expo-analytics](https://github.com/ryanvanderpol/expo-analytics)を使っています。\nさらに踏み込んだ分析をする場合は、[Amplitude](https://amplitude.com/)などを導入すると良さそうです。\n\n# 使用したライブラリ一覧\n以下、TouchLifeで使った主なライブラリ一覧です。\n\n# date-fns\n\n<img src="/images/2019-05-19/date-fns.png" style="width: 100px;">\n\n`5月1日(水)`のような日本語にフォーマットされた日付が必要だったので使いました。\n\n[date-fns](https://github.com/date-fns/date-fns)\n\n# UltraDate.js\n\n<img src="/images/2019-05-19/ultra.png" style="width: 150px;">\n\n`給料日が土日祝の場合はその前の平日を取得する`などが必要で、そちらが取得できるUltraDate.jsを使いました。\nちゃんと実装すると面倒な祝日やうるう年の計算など、Dateオブジェクトを便利に拡張したライブラリです。\n\n[UltraDate.js](https://github.com/hrdaya/UltraDate.js)\n\n# react-native-svg + d3-shape\n\n<img src="/images/2019-05-19/May-11-2019 13-52-45.gif" style="width: 182px;">\n\n円グラフの為に使いました。\n最初は[react-native-pie-chart](https://github.com/genexu/react-native-pie-chart)を使っていたのですが、円グラフをアニメーションさせようとするとreact-native-pie-chartだと難しそうでこちらを使いました。(アニメーションしない円グラフだけの表示ならreact-native-pie-chartでも十分だと思います)\n`d3-shape`で円のデータを作成、それを`react-native-svg`で描画する流れです。\n\n下記の記事が参考になりました。\n[Pie animation in React Native using SVG](https://medium.com/@oriharel/pie-animation-in-react-native-using-svg-55d7d3f90156)\n\n[react-native-svg](https://github.com/react-native-community/react-native-svg)\n[d3-shape](https://github.com/d3/d3-shape)\n\n# formik + yup\n\n<img src="/images/2019-05-19/ezgif-4-4cda48b81c3e.gif" style="width: 292px;">\n\nメールアドレスやパスワードなどフォームのバリデーションが扱いやすくなるので使いました。Reactの[公式ドキュメント](https://reactjs.org/docs/forms.html#fully-fledged-solutions)でも紹介されているものです。\n別の選択肢だと[redux-form](https://github.com/erikras/redux-form)もあり、こちらはフォームの状態をreduxのstoreに保存するようですが、Reactコミュニティの一般的な見解だとフォームの状態をreduxで管理しない方向のようで、`formik`や[react-final-form](https://github.com/final-form/react-final-form)を使うのが良いとのことでした。\n\n[formik](https://github.com/jaredpalmer/formik)\n[yup](https://github.com/jquense/yup)\n\n# native-base\n\n<img src="/images/2019-05-19/ezgif-4-b7a0dbc95f5e.gif" style="width: 294px;">\n\n主にフォームのセレクトボックスで使用。\n最初セレクトボックスは、[react-native-picker-select](https://github.com/lawnstarter/react-native-picker-select)を使っていたのですが、Androidで見た時に表示がおかしかったので、安定していたnative-baseに切り替えました。\n\n[native-base](https://nativebase.io/)\n\n# react-native-calendars\n\n<img src="/images/2019-05-19/May-11-2019 17-51-11.gif" style="width: 294px;">\n\nカレンダーの実装に使っています。\n`monthFormat={"yyyy年MM月"}`などで日本語のフォーマットでカスタマイズ可能なのも良かったです。\n\n[react-native-calendars](https://github.com/wix/react-native-calendars)\n\n# react-native-easy-toast\n\n<img src="/images/2019-05-19/May-11-2019 17-54-10.gif" style="width: 294px;">\n\nマイページなどユーザー情報を変更した時の、成功、失敗をユーザーに知らせる目的で使いました。\n表示する位置や色は自由にカスタマイズ出来ます。\n\n[react-native-easy-toast](https://github.com/crazycodeboy/react-native-easy-toast)\n\n# react-native-keyboard-aware-scroll-view\n\n<img src="/images/2019-05-19/ezgif-4-b16a37b3b4cc.gif" style="width: 294px;">\n\n画面の下の方にInput要素があると、`キーボードが下から出てきた時に入力している部分が隠れてしまい何が入力されているのか分からない問題`があったのですが、その部分が隠れないようにスクロールしてくれるモジュールです。自分で実装するとそれなりに大変そうだったので助かりました。\n\n[react-native-keyboard-aware-scroll-view](https://github.com/APSL/react-native-keyboard-aware-scroll-view)\n\n# react-native-modal\n\n<img src="/images/2019-05-19/ezgif-4-86530604c2b8.gif" style="width: 272px;">\n\nシンプルなモーダルです。\n簡単に表示、非表示が出来て、スタイルもカスタマイズ可能です。\n\n[react-native-modal](https://github.com/react-native-community/react-native-modal)\n\n# react-native-scrollable-tab-view-universal\n\n<img src="/images/2019-05-19/ezgif-4-b8cf6619d868.gif" style="width: 294px;">\n\nタブ切り替えが必要な箇所に使いました。\nスワイプ操作にも対応しているのでUXも良い印象です。\n最初は、[react-native-scrollable-tab-view](https://github.com/ptomasroos/react-native-scrollable-tab-view)を使っていましたが、`ScrollViewの中で使おうとするとAndroidだけ中の要素が表示されない不具合`があり、それが解決されているuniversalを使うことにしました。\nuniversalも`react-native-scrollable-tab-view`をForkしてるものになるので、この不具合が修正が改善されれば、`react-native-scrollable-tab-view`で良いと思います。\n\n[react-native-scrollable-tab-view-universal](https://github.com/turfaa/react-native-scrollable-tab-view-universal)\n\n# react-native-snap-carousel\n\n<img src="/images/2019-05-19/ezgif-4-b97ac0e6144d.gif" style="width: 292px;">\n\nオープニングやグラフのカルーセルに使いました。\n`次や前の月のグラフもちょっと見せるUIにしかった`ので、それが可能だったこちらを使いました。\n\n[react-native-snap-carousel](https://github.com/archriss/react-native-snap-carousel)\n\n# react-native-walkthrough-tooltip\n\n<img src="/images/2019-05-19/May-11-2019 19-16-31.gif" style="width: 294px;">\n\nツールチップの表示に使いました。\nアプリの使い方を伝える最初のチュートリアルにも使えそうです。\nツールチップが画面外にはみ出ないように、`ライブラリ側で位置を自動計算`してくれて使う側がそこを意識しなくてよいのが良かったです。\n\n[react-native-walkthrough-tooltip](https://github.com/jasongaare/react-native-walkthrough-tooltip)\n\n# npm-run-all\n[実践Expo](https://www.amazon.co.jp/dp/B07L5W41H4/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)に書いてあって初めて知ったんですが、これが便利でした。\n`yarn add -D npm-run-all`後に、package.jsonの`scripts`を下記のように書いておいて、\n```json\n"scripts": {\n  "build:ios": "npm-run-all -s ios:*",\n  "ios:run": "expo build:ios --non-interactive",\n  "ios:file": "mkdir -p .build && wget \\"$(expo url:ipa)\\" -O .build/app.ipa",\n},\n```\n`yarn build:ios`すると、`ios:run`や`ios:file`などの`ios:*`のscriptsが順番に実行される、というものです。\nこれでipaファイルが`.build/app.ipa`に生成されるので、後はfastlaneを使ってApp Store Connectにデプロイ → 実機確認 → 申請 → 公開 という感じで無事リリース出来ました。\n\n[実践Expo](https://www.amazon.co.jp/dp/B07L5W41H4/ref=dp-kindle-redirect?_encoding=UTF8&btkr=1)は開発の途中からKindle版を買ったんですが、特にExpoを使ったリリース方法 + AnalyticsやSentryの設定方法も載っていて、とても為になりました。Expoで開発する場合はオススメの一冊です。\n\n# まとめ\nReact Native良いですね。\n開発途中でAndroidで実機確認したんですが、最初にAndroidでiPhoneと同じように動作した時は感動しました。\n\nまた途中からExpoで作り直したのも良かったなと思っています。\n最初はExpoって公式のReact Nativeからちょっと外れたニッチな開発のように感じて、公式から外れるのはどうかな的な感覚があったのですが使ってみると使いやすくて、`必要ならejectしていつでも公式のReact Nativeに戻せる`というのも移行した理由になりました。\n\n`TouchLife`も定期的に更新して、常に改善している事を感じてもらえるアプリにしていきたいと思います。\n最後まで読んでいただき、ありがとうございました👍\n',frontmatter:"title: React Native + FirebaseでiOS & Androidアプリを開発してリリースしました\ndate: 2019-05-19\nimage: https://blog.naoki-otsu.com/images/2019-05-19/og.png",fileName:"2019-05-19-react-native-firebase-touchlife"},{attributes:{title:"ローカルでHTTPサーバー立ち上げる時のメモ",date:new Date(15509664e5)},body:"Github PagesとかNetlifyなどの静的Webコンテンツを作ったとして、本番デプロイ前にローカルサーバーを立ち上げてサクッと確認したい時のメモ。\n開発中は開発用サーバーでデバッグが基本になると思うけど、実際に `yarn build` とかで本番用のファイルが書き出されて、ユーザーの元に届くファイルの構成やサイズを確認したい時とかに。\nいくつか方法がありそう。\n\n# Pythonを使う時\n\n```bash\ncd build\npython -m SimpleHTTPServer\n```\n\n# http-serverを使う時\n[http-server](https://github.com/indexzero/http-server)\n\n```bash\nnpx http-server -d build\n```\n\n# serveを使う時\n[serve](https://github.com/zeit/serve)\nCreate React Appとかで `yarn build` するとこの方法が載っている\n\n```bash\nnpx serve -s build\n```\n\n\nこういう確認の時だけ使うものは `npm install http-server -g` とかでグローバルに入れずに、npxで都度最新のモジュールをオンデマンドで走らせるのが良さそうですね。\n",frontmatter:"title: ローカルでHTTPサーバー立ち上げる時のメモ\ndate: 2019-02-24",fileName:"2019-02-24-local-http-server"},{attributes:{title:"ReactNative + FirestoreでiOSの環境構築",date:new Date(15443136e5)},body:"ReactNative + Firestoreの環境構築を進めていたけど、結構ハマりポイントがあったので忘れないうちに備忘録。\n\n基本的には下記の公式ドキュメントを元に進めていく。\n[https://rnfirebase.io/docs/v5.x.x/installation/initial-setup](https://rnfirebase.io/docs/v5.x.x/installation/initial-setup)\n\nまずはプロジェクトの作成から\n```bash\nreact-native init hogehoge\ncd hogehoge\n```\n\n必要なモジュールをインストール\n```bash\nyarn add react-native-firebase\n```\n\nここから`GoogleService-Info.plist`を入れたり、ソースの修正が必要なので、Xcodeを立ち上げる。\n```bash\nopen ios/{PROJECT_NAME}.xcodeproj\n```\n\nFirebaseでプロジェクトを作って、 `GoogleService-Info.plist` をダウンロード。\nこの辺りは、[ドキュメントを参照](https://rnfirebase.io/docs/v5.x.x/installation/initial-setup)してダウンロードまで進める。\n\nそれと、Firestoreを使うので、ブラウザのFirestore上で最初の使いますボタンのポチ、だけは終わらせとく。\n\n`GoogleService-Info.plist`がダウンロード出来たら、それをXcodeのプロジェクト内にドラッグして入れる。\nその際にリファレンス付けるポップアップが出るので、リファレンス付きで入れるようにする。\n\n直接Finderなどから`ios`直下に入れてもダメで、ちゃんとドラッグしてリファレンス付きで入れる必要がある。\nちゃんと入ってないとrun-iosした時にアプリが立ち上がってすぐにエラー画面もなくクラッシュする。\n\t\nまたXcodeのBundleIDをGoogleService-info.plistのBundleIDと合わせる。\n合わせなくてもrun-iosは走るが、たぶん最終的にXcodeでビルドする時はエラーになる。\n\n次にXcode上の`AppDelegate.m`を開いて、先頭に下記を追加。先頭と言ってもファイルの先頭である必要はない。他の`#import`の下とかで良い。\n```\n#import <Firebase.h>\n```\n\nそれと、`didFinishLaunchingWithOptions:(NSDictionary *)launchOptions`メソッドの下に以下を追加する\n```\n[FIRApp configure];\n```\n\nこれでXcodeは閉じて良い。\n\n次に、ターミナル上で、`Podfile`を生成する\n```\ncd ios\npod init\n```\n\n`Podfile`されるので下記のように編集する。\n```bash\nplatform :ios, '9.0' # ここのコメントを外す\n\npod 'Firebase/Core'\n\n# これはコメントアウトしないとpod install出来ない\n# target 'rnf9-tvOSTests' do\n#   inherit! :search_paths\n#   # Pods for testing\n# end\n```\n\n※注意点\n通常なら、`pod 'Firebase/Firestore'`を`pod 'Firebase/Core'`の下とかに書いて一緒に入れたいけど、なぜかCoreと一緒にインストールすると、run-ios時にエラーが出て動かない。まずCoreを入れてlinkしてFirebaseの構築が出来た後にFirestoreを入れる手順だと無事動いた。\n\nその時のエラー文(は？って感じだ。)↓\n**RNFirebase core module was not found natively on iOS, ensure you have correctly included the RNFirebase pod in your projects `Podfile` and have run `pod install`.**\n\n上の`Podfile`の修正が終わったら\n```\npod install\n```\n\nreact-native-firebaseをlinkする\n```bash\ncd ../\nreact-native link react-native-firebase\n```\n\nlinkが終わったタイミングで、`Podfile`にFirestoreを書き足す。\n```bash\npod 'Firebase/Firestore'\n```\n\nもうFirestoreをインストール\n```\npod install\n```\n\nこれで動くはずなので、App.jsに以下を追加。\n```js\nimport firebase from \"react-native-firebase\";\n\nfirebase\n  .firestore()\n  .collection(\"hoge\")\n  .add({\n    value: '入ってーーー',\n  });\n```\n\nちゃんと使えるかチェックする。\n```bash\nreact-native run-ios\n```\n\nエラーなく初期画面が立ち上がって、更新するたびにFirestoreにデータが格納されていけば成功。\n\n# まとめ\nFirestoreをpod installするタイミングとかが結構、謎でCoreと一緒のタイミングで入れたいけどダメだった。\nGoogleService-info.plistもディレクトリに単に放り込めば良い的なものを見たが、Xcodeから入れないとダメだった。\n結構、はてなが付く事が多いが、これで開発進められるはず..!\n",frontmatter:"title: ReactNative + FirestoreでiOSの環境構築\ndate: 2018-12-09",fileName:"2018-12-09-react-native-firestore"},{attributes:{title:"AWS Lambda + Puppeteerでダイナミックレンダリングする",date:new Date(1543536e6)},body:'基本的には下記のサイトが非常に参考になった。\n[SSRをやめる。OGP対応はLambda@Edgeでダイナミックレンダリングする。](https://qiita.com/geerpm/items/78e2b85dca3cb698e98d)\n\nこの記事ではPuppeteerは使っていないが、Puppeteerで目的のダイナミックレンダリングが出来そうだったのでやってみた。\n\n基本的に上記のやり方を参考に進めて、キモであるダイナミックレンダリングするところだけ、Puppeteerを使うように変更した。今回は主にその部分の備忘録。ServerlessもWebpackも使っていない。\n\n# 全体の流れ\n\nまずはざっくりとした全体の流れから。\n1. **html, css, jsとかのアセットをS3に配置して静的ホスティングする**\n1. **そのS3をCloudFront経由で配信する**\n1. **LambdaのViewer RequestでUserAgentからボットの判別をして、ボットだったらカスタムヘッダーを付与する**\n1. **LambdaのOrigin Requestでボット用のカスタムヘッダーが付いてたらPuppeteerでダイナミックレンダリングする**\n\nViewer RequestやOrigin RequestなどのLambda@Edgeのライフサイクルイベントについては、[公式](https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/lambda-edge.html)がわかりやすい。\n\n以下、CloudFrontで配信するのが終わったあとのところから。\n\n# LambdaのViewer RequestでUserAgentからボットの判別をして、ボットだったらカスタムヘッダーを付与する\n\nほとんど参考記事のままだが、下記のようなViewer Request Functionを準備して、Lambda上のエディタにペーストしてデプロイ。\nやっているのは、UserAgentがクローラーで、かつhtmlへのリクエストだったらダイナミックレンダリング用のカスタムヘッダーをつける、という感じ。\n```js\n"use strict";\n\nexports.handler = (event, context, callback) => {\n  const request = event.Records[0].cf.request;\n  const headers = request.headers;\n\n  const crawlers = [\n    "Googlebot",\n    "facebookexternalhit",\n    "Twitterbot",\n    "bingbot",\n    "msnbot"\n  ];\n\n  const excludeExtentions = [\n    "jpg",\n    "png",\n    "gif",\n    "jpeg",\n    "svg",\n    "css",\n    "js",\n    "json",\n    "txt",\n    "ico",\n    "map"\n  ];\n\n  const dynamicRenderHeaderName = "X-Need-Dynamic-Render";\n\n  const extention =\n    request.uri === null || request.uri === "/"\n      ? ""\n      : request.uri\n          .split(".")\n          .pop()\n          .toLowerCase();\n  const maybeHtml = !excludeExtentions.some(e => e === extention);\n\n  const isCrawler = crawlers.some(c => {\n    return headers["user-agent"][0].value.includes(c);\n  });\n\n  // UserAgentがクローラーで、かつhtmlへのリクエストだったらカスタムヘッダーをつける\n  if (isCrawler && maybeHtml) {\n    request.headers[dynamicRenderHeaderName.toLowerCase()] = [\n      {\n        key: dynamicRenderHeaderName,\n        value: "true"\n      }\n    ];\n  }\n\n  callback(null, request);\n};\n```\n\n# LambdaのOrigin Requestでボット用のカスタムヘッダーが付いてたらPuppeteerでダイナミックレンダリングする\n\nここの流れとしては、\n1. **npm initしてpackage.jsonを生成**\n1. **Puppeteerとか必要なモジュールをnpm install**\n1. **Puppeteerを使ってダイナミックレンダリングの処理を書く**\n1. **実装が終わったら、node_modulesとかも含めてzip圧縮してLambda上からzipでアップロードして、デプロイする**\n\nという感じ。\n\nServerlessを使うとzip化してデプロイの作業が効率化出来るので実案件とかだと使った方が良さそうか。\n\nローカルの作業場所はどこでも良いので、おもむろに `npm init -y` とかでpackage.jsonを生成する。\nそして必要なモジュールを`npm install`していく\n```json\n"dependencies": {\n  "@serverless-chrome/lambda": "^1.0.0-55",\n  "chrome-remote-interface": "^0.27.0",\n  "puppeteer-core": "^1.11.0"\n}\n```\n\n`puppeteer-core`じゃなくて`puppeteer`を普通に`npm install`すると、Chromiumも一緒にダウンロードしてしまって、そうなるとLambdaの50MBの制限に容易に引っかかってしまう。\nなのでPuppeteer1.7以降から追加された、`puppeteer-core`をインストールするようにする。\n\nインストール出来たら実際にPuppeteerを使ってダイナミックレンダリングの実装を`index.js`に書いていく。\n```js\n"use strict";\n\nconst launchChrome = require("@serverless-chrome/lambda");\nconst CDP = require("chrome-remote-interface");\nconst puppeteer = require("puppeteer-core");\n\nexports.handler = async (event, context, callback) => {\n  const dynamicRenderHeaderName = "X-Need-Dynamic-Render";\n  const request = event.Records[0].cf.request;\n  const headers = request.headers;\n\n  // クローラーじゃなかったら何もしない\n  if (!headers[dynamicRenderHeaderName.toLowerCase()]) return callback(null, request);\n\n  // クローラーだったら、ダイナミックレンダリングする\n  let slsChrome = null;\n  let browser = null;\n  let page = null;\n\n  try {\n    // Chromeの立ち上げ\n    slsChrome = await launchChrome();\n\n    // WebSocketを使ってPuppeteerと繋げる\n    browser = await puppeteer.connect({\n      browserWSEndpoint: (await CDP.Version()).webSocketDebuggerUrl\n    });\n\n    page = await browser.newPage();\n    await page.goto("https://ダイナミックレンダリングしたいURL/", {\n      waitUntil: "networkidle0"\n    });\n    const html = await page.content();\n\n    await browser.close();\n    await slsChrome.kill();\n\n    const response = {\n      status: "200",\n      statusDescription: "OK",\n      headers: {\n        "cache-control": [\n          {\n            key: "Cache-Control",\n            value: "max-age=100"\n          }\n        ],\n        "content-type": [\n          {\n            key: "Content-Type",\n            value: "text/html"\n          }\n        ],\n        "content-encoding": [\n          {\n            key: "Content-Encoding",\n            value: "UTF-8"\n          }\n        ]\n      },\n      body: html.replace("<html", \'<html style="background: #ff0;"\') // 試しにボットの時だけ背景色を黄色に変えてみる\n    };\n\n    return callback(null, response);\n  } catch (err) {\n    return callback(err);\n  }\n};\n```\n\nこんな感じに。\nボットの時に元のコンテンツに変化がないと、ちゃんとダイナミックレンダリングされてるか分からないので、`<html style="background: #ff0;">`を入れて全体が黄色になればOKという感じにした。\n\nこれが出来たら`node_modules`や`package.json`、`index.js`など含めてzip化する。\nそのzipをLambdaにアップロードしてデプロイする。\n\n# 注意点\n\n## Finderの右クリックでzip化してしまうとLambdaで動かした時にエラーが出てしまう\n\nzip化はコマンドで行うと問題なかった。\npackage.jsonのある場所で、`zip -r app.zip * `とかでzipにする。\n\n\n## Origin Requestの設定\n\nOrigin Requestのデフォルトの設定だと、WebSocketでPuppeteerとconnectするところでタイムアウトエラーになってしまった。\n\n色々試したところ、どうもLambdaの管理画面上で設定できる、メモリとタイムアウトまでの時間を変更する必要があった。\nデフォルトのマシンの性能だと非力すぎて、タイムアウトまでに処理が出来ない、ということのようだ。\n\nデフォルトの設定から\nメモリ 128MB → 512MB\nタイムアウト 3秒 → 30秒\nに変えたところエラーが消えて、無事にPuppeteerがLambda上で動いた。\n\n<img src="/images/2018-11-30/lambda.png" width="100%">\n\n# 動作確認\n\n動作確認は、ChromeのDevToolsの`Network conditions`から`Googlebot`をチェックしてサイトにアクセスすることで確認出来る。\nボットの時に黄色のページが表示されて、ボットじゃない時は元のページが表示されればOK。\n\n<img src="/images/2018-11-30/pc.png" width="100%">\n\n[モバイルフレンドリーテスト](https://search.google.com/test/mobile-friendly?hl=ja)もOK\n\n<img src="/images/2018-11-30/friendly.png" width="100%">\n\n[Fetch as Google](https://support.google.com/webmasters/answer/6066468?hl=ja)も問題なさそう。\n<img src="/images/2018-11-30/fetch.png" width="100%">\n\n# まとめ\nLambda + Puppeteerでダイナミックレンダリングが出来た。\nLambdaの仕組みからよく分かってなかったのでキャッチアップしながら進めて、内容的にもそこまで難しくもないだろうと思っていたが、Lambdaの50MBの制限やメモリを上げないといけなかった事とかハマるポイントはあった。\n実際は`LambdaでPuppeteerを動す`が出来たらあとはhtml取得して返すだけなので、動かすところまでがキモになりそう。\n\nおしまい。\n',frontmatter:"title: AWS Lambda + Puppeteerでダイナミックレンダリングする\ndate: 2018-11-30",fileName:"2018-11-30-lambda-puppeteer-dynamic-rendering"},{attributes:{title:"React NativeでiOSとAndroidのアプリのアイコンを変更する",date:new Date(15429312e5)},body:'ReactNativeというわけではないけど、iOSとAndroidのアプリのアイコンをデフォルト画像から自前で準備したアイコンに設定する時のメモ。と言っても驚くほど簡単だった。\n\n# アプリのアイコン画像を準備する\n\nまずは画像の準備から。\nアイコンサイズは `1024 x 1024` で準備しとく。\n\n<img src="/images/2018-11-23/icon.png" width="20%">\n\nたぶんPhotoshopやXDを使って作成すると、サイズ別で書き出しが出来ると思うけど、それらが無い場合はそれぞれのサイズに書き出してくれるWebサービスを使っても出来そう。パッと試したい時とか。\n\n使ったのは下記のサービス\n[App Icon Resizer](https://resizeappicon.com/)\n\nここに画像をアップロードすると、iOS,Androidに必要なアイコンをサイズ別でダウンロードすることが出来る。これらをダウンロードして手元に持っておく。\n\n# iOSでアプリのアイコンを設定する\n\niOSの場合はXCodeからアイコン設定出来る\nXcodeでプロジェクトを開く(`/ios/hoge.xcodeproj`をXcodeで開く)\n\n下記のキャプチャのように `images.xcassets` → `AppIcon` をクリックすると、サイズ別にアプリアイコンが設定出来るので、そこに画像をドラッグ&ドロップで格納していく。\n\n<img src="/images/2018-11-23/xcode.png" width="50%">\n\nこれで`react-native run-ios`して、シミュレーター上でもアイコンが変更されてたらOK!\n\n<img src="/images/2018-11-23/iphone.png" width="50%">\n\n# Andoirdでアプリのアイコンを設定する\n\nAndroid側はAndroid Studioは使わない。ディレクトリに画像を入れるのみ。入れる場所は、`/android/app/src/main/res/`の直下に、\n`mipmap-mdpi`\n`mipmap-hdpi`\n`mipmap-xhdpi`\n`mipmap-xxhdpi`\n`mipmap-xxxhdpi`\nのサイズ別のディレクトリがあって、すでにデフォルトのアプリアイコンの画像が格納されているので、そこの画像を差し替えする。\n\n画像サイズは下記のように格納する\n`mdpi → 48 x 48`\n`hdpi → 72 x 72`\n`xhdpi → 96 x 96`\n`xxhdpi → 144 x 144`\n`xxxhdpi → 192 x 192`\n\nこの`mipmap-mdpi`などのディレクトリ名と`ic_launcher.png`のファイル名は変更出来て、`android/app/src/main/AndroidManifest.xml`の`android:icon="@mipmap/ic_launcher"`で管理されている。\n\nまたAndroid7.1からはアプリアイコンに丸いアイコンが追加されて`AndroidManifest.xml`で従来のアイコンの他に`android:roundIcon="@mipmap/ic_launcher_round"`を指定しておくと、対応デバイスで丸いアイコンが表示されるようになったもよう。\n\n差し替えた状態で`react-native run-android`してシミュレーター上でもアプリアイコンが変わっていたらOK!\n\n<img src="/images/2018-11-23/android.png" width="50%">\n\nシミュレーターでうまくいってたら実機側も問題なくアイコン画像変わってた! おしまい。\n',frontmatter:"title: React NativeでiOSとAndroidのアプリのアイコンを変更する\ndate: 2018-11-23",fileName:"2018-11-23-react-native-change-app-icon"},{attributes:{title:"React Native v0.57以降のTypeScript環境構築",date:new Date(15419808e5)},body:'ReactNative v0.57以降はTypeScriptがデフォルトから書けるということでやってみたら確かに出来たので、構築方法の備忘録。\nhttps://qiita.com/Nkzn/items/cf1516136d2db981fbb9\n\nまずはReactNativeプロジェクトをinitで作成。\n```bash\nreact-native init react-native-typescript\n```\n\n必要なnode_modulesをインストール\n```bash\nyarn add --dev typescript @types/react @types/react-native\n```\n\ntsconfig.jsonの雛形を作成\n```bash\nyarn tsc --init --pretty --jsx react\n```\n\ntsconfig.jsonの`"allowSyntheticDefaultImports": true,`のコメントアウトを外す\n\n以上で完了なので、iosを立ち上げてみる。\n\n```bash\nreact-native run-ios\n```\n\n<img src="/images/2018-11-12/iphone3.png" width="50%">\n\n完了!\n',frontmatter:"title: React Native v0.57以降のTypeScript環境構築\ndate: 2018-11-12",fileName:"2018-11-12-react-native-typescript"},{attributes:{title:"React Nativeで起きたエラーと解決策",date:new Date(15412896e5)},body:'React Nativeの開発で起きたエラーと解決策のまとめ\n\n# Print: Entry, “:CFBundleIdentifier”, Does Not Existのエラー\n\n`react-native init hogehoge` して\n`react-native run-ios`した時に出たエラー\n”:CFBundleIdentifier”が見つからないもよう\n\n## 解決策\n`/ios/プロジェクト名.xcodeproj`をXcodeで開いて、File → Project Settingsのメニューの中から「Advanced」を選択して、下記のように設定すると良かった。\n\n<img src="/images/2018-11-04/xcode.png" width="80%">\n\nもしくは別の解決策で、\n```bash\nnpm i -g react-native-git-upgrade\nreact-native-git-upgrade\n```\nでも直った。\n※さらに、`react-native upgrade`でも直るっぽいけど、`react-native-git-upgrade`が公式にも載ってるupgradeの方法のようで、`react-native upgrade`は[iOS全体の設定を上書きするような記載](https://stackoverflow.com/a/37505341)もあるのでやらない方が吉なのかも。\n\n### 参考\nhttps://www.haneca.net/react-native-cfbundleidentifier-error/\nhttps://stackoverflow.com/questions/37461703/print-entry-cfbundleidentifier-does-not-exist\n\n# Couldn\'t find preset "module:metro-react-native-babel-preset"のエラー\n\n`yarn test` や`react-native upgrade`した時に下記のようなエラーが出た\n```\nCouldn\'t find preset "module:metro-react-native-babel-preset" relative to directory "/Users/naokiotsu/Desktop/git/naokiotsu/sandpit/ReactNative/rnt4"\n```\n\n## 解決策\nbabel6 → babel7への橋渡しが必要なようで、\n`yarn add --dev babel-core@^7.0.0-bridge.0 @babel/core` して\n`.babelrc` → `babel.config.js` にリネームして、\n```\nmodule.exports = function(api) {\n  api.cache(true);\n\n  return {\n    presets: ["module:metro-react-native-babel-preset"]\n  };\n};\n```\nを記述すると無事テストも通るようになった\n\n`babel.config.js`は[babel自身](https://github.com/babel/babel/blob/master/babel.config.js)も使っていて、`.babelrc`より推奨されてるみたい。でもなぜ`react-native init`した時のデフォルトが`.babelrc`なのかは分からない。\n\n### 参考\nhttps://github.com/facebook/react-native/issues/21241#issuecomment-431464191\n',frontmatter:"title: React Nativeで起きたエラーと解決策\ndate: 2018-11-04",fileName:"2018-11-04-react-native-error"},{attributes:{title:"GraphQL + RailsでDBからデータ取得までのメモ",date:new Date(15411168e5)},body:'GraphQL + Railsな環境で、\nDBの`users`テーブルの中の`id`と`email`を`GraphiQL`上で取得するところまでのメモ\n\n最終的に\n[http://localhost:3000/graphiql](http://localhost:3000/graphiql)\nにアクセスして、下記のクエリを実行して、\n```\nquery {\n  user {\n    id\n    email\n  }\n}\n```\n\n下記になったらゴールのところまで \n```\n{\n  "data": {\n    "user": {\n      "id": 1,\n      "email": "hoge@example.com"\n    }\n  }\n}\n```\n\nまずはrailsプロジェクトを作成\n```bash\nrails new graphql-rails-example\n```\n\nDB作成\n```bash\nrails db:create\n```\n\n`Gemfile`に`\'graphql\'`を追加(これを書いてる時の最新バージョンは1.8.10)\n※2018年5月ぐらいのバージョン1.8+から[Class-Based API](http://graphql-ruby.org/schema/class_based_api)に変わり実装が変わって、\n昔の`.define-style`な書き方だとエラー出ちゃうので、`Class-Based API`で実装していく\n```ruby\ngem \'graphql\', \'~> 1.8.10\'\n```\n\nインストール\n```bash\nbundle\n```\n\n`graphql`は最初の雛形を作る便利なgenerateがあるので、\nそれを使ってもろもろ必要なファイルを生成(`Class-Based API`ベースなファイルが生成される)\n```bash\nrails g graphql:install\n```\n\nこれで必要なファイルが生成されるのと同時に、`Gemfile`に`gem \'graphiql-rails\', group: :development`が追加されて\n`GraphiQL`っていうブラウザ上でGraphQLのqueryとかmutationとかを叩いて試せるGUIが操作出来るようになるので、それをインストール\n```bash\nbundle\n```\n\nローカルサーバーの立ち上げ\n```bash\nrails s\n```\n\n[http://localhost:3000/graphiql](http://localhost:3000/graphiql)\nにアクセスして、下記のqueryを実行\n`testField`が取れるか確認する\n```\nquery {\n  testField\n}\n```\n\n`Hello World!`が取れてたらOK!\n```\n{\n  "data": {\n    "testField": "Hello World!"\n  }\n}\n```\n\n今度は本題のDBに格納された値を取得したいので、User Modelを作成\n```bash\nrails g model User name:string email:string\n```\n\nmigrateして、usersテーブルを作成\n```bash\nrails db:migrate\n```\n\n`GraphQL`用のgenerateコマンドが準備されてるので、\nそれを使ってUser Typeを生成する\n```bash\nrails g graphql:object User id:Int! email:String\n```\n\nこれで`app/graphql/types/user_type.rb`が生成される\nそして、実際にDBの中にデータを入れるので`rails c`して\n```bash\nrails c\n```\n\n1件データを挿入\n```ruby\nUser.create!(id: 1, email: \'hoge@example.com\')\n\nUser.count # 1\n```\n\nDBに追加したUserを取得したいので、`app/graphql/types/query_type.rb`に下記を追加する\n```ruby\nfield :user, Types::UserType, null: false, resolve: ->(obj, args, ctx) { User.first }\n```\n\n`resolve`のところで、どのデータを返すのか、データを加工して返したいとかロジックを書くことができる\n実際にはログインしているUserを`ctx[:current_user]`とかで返すことになりそう\n`field`の書き方は`Class-Based API`になって変わったので、昔の書き方だとエラーが出る \n今回はサンプルなので、`User.first`で最初のUserを返すようにした\n\ngraphiqlの方で下記のqueryを実行\n```\nquery {\n  user {\n    id\n    email\n  }\n}\n```\n\n下記のようにちゃんとデータが取れてたら、OK..!\n```\n{\n  "data": {\n    "user": {\n      "id": 1,\n      "email": "hoge@example.com"\n    }\n  }\n}\n```\n\n参考\nこのYoutubeの解説動画が分かりやすかったです\n[Rails + GraphQL Tutorial - Building a GraphQL API Server](https://www.youtube.com/watch?v=DaznKqh5Ypk)\n',frontmatter:"title: GraphQL + RailsでDBからデータ取得までのメモ\ndate: 2018-11-02",fileName:"2018-11-02-graphql-rails-first-query"},{attributes:{title:"rbenvとnvmのコマンド早見表",date:new Date(15406848e5)},body:"いつも`rbenv`と`nvm`のコマンド何だっけ？ってググる事になるので、さっと打てるようにメモしておく。\n\n# rbenv\n\n```bash\n$ rbenv install -l    # インストール可能なバージョンを一覧表示\n$ rbenv versions      # 現在インストールされているバージョン表示\n$ rbenv install 2.2.0 # 指定バージョンをインストール\n$ rbenv global 2.2.0  # 指定バージョンをglobalにインストール\n$ rbenv local 2.2.0   # 指定バージョンをlocalにインストール\n$ rbenv rehash        # ruby -vでバージョン変わらない時とかに\n\n$ cd ~/.rbenv/plugins/ruby-build && git pull # ruby-buildを最新に(rbenv install -l 結果をupdateしたい時)\n```\n\n# nvm\n\n```bash\n$ nvm ls-remote            # インストール可能なバージョンを一覧表示\n$ nvm install v9.4.0       # 指定バージョンをインストール 切り替えまでするもよう\n$ nvm ls                   # 現在インストールされている全バージョンを確認\n$ nvm use v9.4.0           # 指定バージョンに変更\n$ nvm alias default v9.4.0 # PCのSystemのdefaultバージョンを指定\n```\n",frontmatter:"title: rbenvとnvmのコマンド早見表\ndate: 2018-10-28",fileName:"2018-10-28-commands-rbenv-and-nvm"},{attributes:{title:"1年分のDateオブジェクトを月単位の配列で取得する JS",date:new Date(15399936e5)},body:"文章で説明するのが難しいけど、  \n家計簿っぽいものを作ってると今日の日付から1年前までの月単位のDateオブジェクトの配列データが欲しかったりする。\n\n今日が、2018年10月20日だとすると\n```js\n[\n  Sat Oct 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Thu Sep 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Mon Aug 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Fri Jul 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Wed Jun 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Sun May 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Fri Apr 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Tue Mar 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Tue Feb 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Sat Jan 20 2018 00:00:00 GMT+0900 (日本標準時) {},\n  Wed Dec 20 2017 00:00:00 GMT+0900 (日本標準時) {},\n  Mon Nov 20 2017 00:00:00 GMT+0900 (日本標準時) {}\n]\n```\nこんなDateオブジェクトが入った配列が欲しい時\n\nこれは下記で取得できる\n```js\n[...Array(12)].map((_, index) => {\n  const today = new Date();\n  return new Date(\n    today.getFullYear(),\n    today.getMonth() - index,\n    today.getDate()\n  );\n});\n```\n\n手順的には、\n- `[...Array(12)]`で `[undefined, undefined, ...]`が取れて、それをmapする(今回は12ヶ月分の配列が欲しいので)\n- `new Date(年, 月, 日)`で指定した日付のDateオブジェクトが取れるので、`today.getMonth() - index`で月をデクリメントしつつ\b返してあげる\n\n単純だけど、一瞬あれどうだっけ？となるのでメモ。\n",frontmatter:"title: 1年分のDateオブジェクトを月単位の配列で取得する JS \ndate: 2018-10-20",fileName:"2018-10-19-js-loop-between-month-ranges"},{attributes:{title:"highlight.jsのソースコードを改行させないCSS",date:new Date(1539648e6)},body:'このブログは、<a href="https://highlightjs.org/" target="_blank">hightlight.js</a>を使ってソースコードのハイライト表示をしているけど、デフォルトだと横幅を超えると改行されるようになっていて、これを改行させずにスクロールして表示するようにしたいなぁと思ってた。そんな時のCSS。\n\n``` css\npre {\n  overflow: auto;\n  word-wrap: normal;\n  white-space: pre;\n}\n```\n\nこれでスクロールしてソースコード表示出来るように。\nただiOSだとスクロールに引っ掛かりがあるので、さらに `-webkit-overflow-scrolling: touch;` を入れてスムーズにスクロールするようにした。\n\n\n',frontmatter:"title: highlight.jsのソースコードを改行させないCSS\ndate: 2018-10-16",fileName:"2018-10-16-highlight-js-pre-code-word-wrap"},{attributes:{title:"JS 配列の中から対象オブジェクトを取り出す",date:new Date(15388704e5)},body:"JavaScriptで実装してると、配列の中がオブジェクトから成り立ってるという事がよくある\n\n```js\nconst list = [\n  { id: 1, name: 'ナオケル', sex: '男性' },\n  { id: 2, name: 'ジョーダン', sex: '男性' },\n  { id: 3, name: '花子', sex: '女性' }\n];\n```\n\nそしてこれを操作したい時に、\n`ある条件のオブジェクトだけを1つ取り出す`\nもしくは、\n`ある条件のオブジェクトだけにフィルタリングされた配列を取得する`\nということがままある\n\n実装自体はすごく簡単だけど、そんな時の備忘録として\n\n# 配列から指定のオブジェクトを1つだけ取り出す\n\n`find()`を使うと、配列の中から条件にあった最初の要素を1つ返してくれる\n見つからないときは`undifined`を返す\n\n<a href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/find\">Array.prototype.find()</a>\n\n``` js\nconst list = [\n  { id: 1, name: 'ナオケル', sex: '男性' },\n  { id: 2, name: 'ジョーダン', sex: '男性' },\n  { id: 3, name: '花子', sex: '女性' }\n];\n\nconst result = list.find(item => item.id === 2); // idが2の要素を返す\n\nconsole.log(result); // { id: 2, name: 'ジョーダン', sex: '男性' }\n```\n\n# 配列から指定のオブジェクトからなる配列を取得する\n\n`filter()`を使うと、関数の条件が`true`の要素からなる配列を返してくれる\n見つからないときは空の配列を返す\n\n<a href=\"https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/filter\">Array.prototype.filter()</a>\n\n``` js\nconst list = [\n  { id: 1, name: 'ナオケル', sex: '男性' },\n  { id: 2, name: 'ジョーダン', sex: '男性' },\n  { id: 3, name: '花子', sex: '女性' }\n];\n\nconst result = list.filter(item => item.sex === '男性'); // sexが男性の要素の配列を返す\n\n/*\n  [\n    { id: 1, name: 'ナオケル', sex: '男性' },\n    { id: 2, name: 'ジョーダン', sex: '男性' }\n  ]\n*/\nconsole.log(result);\n```\n\nかなり基礎的だけど、\n配列操作はかなり頻繁に起きうるのでしっかり固めたい。\n",frontmatter:"title: JS 配列の中から対象オブジェクトを取り出す\ndate: 2018-10-07",fileName:"2018-10-07-javascript-array-in-object"},{attributes:{title:"英語圏のサイトをヒットさせるGoogle検索",date:new Date(15388704e5)},body:'開発していて、バグに遭遇するとGoogle先生に頼ることは多い\nそんな時に日本語サイトでピンポイントにそのバグの解消法が載っていたらラッキーで、\nほとんどの場合、海外の`Stack Overflow`かGitHubの`Issue`で解決に導かれることが多い\n\nそうなると英語圏のググり力が大事になってくるけど、そんな時の「自分はこうやってます」メモ\n`いやいやもっと良い方法あるよ`って方は教えて頂けると有り難いです\n\n# 英語圏のサイトをヒットさせるGoogle検索\n\n英語圏でGoogle検索したい時、自分は下記のURLを開いて検索してる\n\n<a href="https://www.google.com/webhp?gl=us&hl=en&gws_rd=cr&pws=0" target="_blank" rel="noopener">\n  https://www.google.com/webhp?gl=us&hl=en&gws_rd=cr&pws=0\n</a>\n\n英語圏のクエリパラメーターが付いていて、基本的に英語サイトがヒットする\nバグの場合、エラー文言などで検索すると、高い確率で海外の`Stack Overflow`かGitHubの`Issue`が上位に表示される\n\n自分はこのURLをブックマークして、パッと開けるところに置いてる\n\nこの方法を知る前は、Google検索の`「設定」`から言語を`「英語」`に変えて検索したりしていた。\nこれでも英語はヒットするけど、操作がめんどくさいのと、英語圏に混じって日本語サイトが表示される事も多かったので、上記のURLに切り替えた\n\n# 公式サイトを見たい時も\n\n以前に比べて、公式のドキュメントを見る機会が圧倒的に多くなったと感じているけど、\n公式のドキュメント系も、このURLから検索するとだいたい1番最初にヒットしてくれる\n\n日本語圏で検索していると`「React」`なんかで検索しても、大量の日本語の入門記事がヒットして、肝心のReactの公式サイトはヒットしてくれない\n無いかもしれない公式サイトのリンクを求めて、「あってくれ!」と願いながらネットサーフィンすることさえある..(TT)\n\nという訳で、自分の中では結構重宝している検索方法の紹介でした\nちゃんちゃん\n',frontmatter:"title: 英語圏のサイトをヒットさせるGoogle検索\ndate: 2018-10-07",fileName:"2018-10-07-english-google-search"},{attributes:{title:"CSSアニメーションにおけるGPUをまとめてみた",date:new Date(15386976e5)},body:'最近、CSSアニメーションにおけるGPUについて調べる事があったので、まとめてみた。\n\n# GPUとCPU\nCSSアニメーションのパフォーマンスを改善する際に、GPU,CPUで処理する考え方が必要になってくる。  \n\n## GPUとは\n`GPU(Graphics Processing Unit)` ・・・ 画像処理を担当する部品の１つ  \n\n## CPUとは\n`CPU(Central Processing Unit)` ・・・ コンピュータの制御や演算や情報転送をつかさどる中枢部分\n\n# なぜGPUがパフォーマンス改善に役立つのか\n通常はCPUのみでアニメーションの演算や描画までを行っている。\nただ描画性能が高いGPUに描画処理を任せる事で、描画パフォーマンスが改善が期待出来る。  \nこのGPUに描画処理を任せる行為を、 `ハードウェアアクセラレーション` と呼んでいる。  \n\n## ブラウザにおけるハードウェアアクセラレーション\n\n通常ブラウザは、表示するページを1枚の絵として描画する。\nハードウェアアクセラレーションが適用された要素は、一枚の絵の上に別レイヤーを作る。\n処理を切り離してGPUで処理させることで、処理を最適化させる事ができるという仕組み。  \n\n<a href="http://jsfiddle.net/zFUVd/9/" target="_blank" rel="noopener">ハードウェアアクセラレーションが適用されているイメージ</a>を作っている方がいらっしゃった。\n\n## ハードウェアアクセラレーションを適用させるには\n\n下記のプロパティを使ったCSSアニメーションはGPU処理となる。  \n- opacity\n- translate\n- rotate\n- scale\n- 3D系プロパティ(translate3D, scale3d, rotate3dなど)\n\n# GPU処理されているか確認する\n\nChrome DevToolsの `Rendering` を見る事で実際にGPU処理されているか確認出来る。\n\n具体的に下記の確認できる。\n- 再描画されている要素\n- GPUレイヤーで生成されている要素\n- FPSなどの計測\n\n# topやleftなどのプロパティをGPU処理させるには\n\ntopやleftなどもGPUレイヤーで処理させる事が出来る。\n下記のプロパティの`いずれかを`一緒に当てると、`GPUレイヤーが生成されGPU処理`となる。  \n\n- backface-visibility: hidden;\n- transform: translateZ(0);\n- transform: translate3d(0, 0, 0);\n\nただやはり移動させる系のプロパティは、translateやtranslate3dを使った方がパフォーマンスには良いとのこと。  \n\n<a href="http://jsfiddle.net/eVtbM/30/" target="_blank" rel="noopener">GPU適用のExample</a>\n\n# 注意点: GPU処理もやりすぎると逆にパフォーマンスは落ちてしまう..\n\nとても良さそうに見えるGPU処理。\nだけどGPU処理もレイヤーを生成させて管理するコストがかかっている。\nやりすぎると逆にCPUへの負荷が高まりパフォーマンス低下を招いてしまうもよう。  \n\n`GPU処理によるデメリット`\n- アニメーションのチラツキ  \n- 動作が重くなる  \n- 描画崩壊  \n- ゴミがつく  \n\n※ハック的にGPUレイヤーを生成する `transform: translate3d(0, 0, 0);` などの指定も、多用しすぎると上記の現象が起きてしまうので、注意が必要そう。  \n\n具体的には、下記の点に気をつけると良さそうだった。  \n- GPU処理させている要素がたくさんありそうな時に注意する\n- GPU処理させる要素に子要素が必要な場合は出来る限り少なくする\n- 使用してない要素は、display:none;かGPU処理を切るようにする\n- bodyタグなど包括しているタグに、transform: translateZ(0);は指定しない\n- GPU処理もCPUへのコストがかかっている事を意識しておく\n- モバイルは特にブラウザの性能が低い事を知っておく\n\nGPUを考慮して、快適なCSSアニメーションライフを送っていきたいですね..!\n',frontmatter:"title: CSSアニメーションにおけるGPUをまとめてみた\ndate: 2018-10-05",fileName:"2018-10-05-gpu-cpu-css-animation"},{attributes:{title:"VSCodeのウィンドウ(ワークスペース)切り替えのショートカット(for Mac)",date:new Date(15351552e5)},body:'結論、Mac標準のショートカットを使うってことになるけど、\nVSCodeを使っていると、複数ウィンドウを切り替えつつ作業する事がよくある。\n\nどこかのリポジトリをgit cloneして、ソースを眺めたり、進行中のプロジェクトと見比べたり。\n\nVSCodeは `Control + w` でウィンドウ切り替えが出来るけど、\n`一覧を呼び出す` → `選ぶ` の操作が必要で、だんだん煩わしくなってくる。\n`Command + Tab`のように次のワークスペースに片手でパッパッと切り替えたいなぁと思ってた。\n\n<img src="/images/2018-08-25/vscode-shortcuts.png" width="80%">\n\n方法はMac標準のショートカットを使うってことになるけど、\n`システム環境設定` → `キーボード` → `ショートカット`タブの → `キーボード` の `次のウィンドウを操作対象にする`\nを使うと良さそう\n\n<img src="/images/2018-08-25/vscode-image1.png" width="80%">\n<img src="/images/2018-08-25/vscode-image2.png" width="80%">\n\nこのショートカット、デフォルトは `option + F1` とかになってて、\nそのままだと使い辛いので、自分は `option + tab` に変えてる\n今のところ、快適に作業出来てるし特に問題ないかなぁ。\n',frontmatter:"title: VSCodeのウィンドウ(ワークスペース)切り替えのショートカット(for Mac)\ndate: 2018-08-25",fileName:"2018-08-25-mac-keyboard-shortcuts-when-vscode"},{attributes:{title:"VS Code + Vimで効率的にコーディング",date:new Date(1523664e6)},body:'VSCodeはIntelliSenseが良かったり、Emmetがデフォルトで付いて来たりと、ずっと重宝しているエディタの一つ。\n何より日々エディタ自体が改善されている感じが好きで毎回のアップデートが楽しみだったりする。\n\nそんなVSCodeだけど、業務として1日中コードを書いていると夕方辺りでコードを書くのがだんだん辛くなっていくのが気になっていた。\nVSCodeに限らずどのエディタを使ってもその疲れはくるんだけど、要はマウス操作でファイルを選択したりタブを移動したり、Shiftキーを押しながらコードをコピーしてペーストして、といった感じでホームポジションからどうしても離れないといけない瞬間があり、それが溜まりたまって夕方ぐらいに疲れが押し寄せてくる感じ。\n\nどうにかもっと効率的に体力使わずコードを書いていきたい。ホームポジションから離れずとなるとvimとかemacsとかか。\nそんな事を思っている時にふとGoogleの凄そうな人のLive CodingをYoutubeで眺めていたら、VSCodeでvimっぽくコーディングしてらっしゃる。\nhttps://www.youtube.com/watch?v=X8EQSy-ajo4&t=1559s\n\nあ、これだ。ということでVSCodeでvimのように操作できるvscodevimのプラグインを入れて試してみた。\n\n結構良い感じ。\n基本はvimのコーディングでホームポジションから離れる事が少なくなった。かつ割り当てたキーバインドで全ファイル検索やサイドバーのファイル移動、ターミナル(tmux)を開いてgitやコマンドが叩けたりしてitermを使う事も少なくなった。\nそして、必要ならマウス操作もこれまで同様に可能だったりする。\n\nこちらのブログを参考にさせて頂きつつ、自分なりにキーバインドをカスタマイズした。\nhttps://qiita.com/y-mattun/items/45776b7e1942edb2f727\n\nkeybindings.jsonは下記の感じ\n```\n[\n    // プロジェクト全体検索の切り替え\n    {\n        "key": "ctrl+f",\n        "command": "workbench.action.findInFiles",\n        "when": "!searchInputBoxFocus"\n    },\n    {\n        "key": "ctrl+f",\n        "command": "workbench.action.focusFirstEditorGroup",\n        "when": "searchInputBoxFocus"\n    },\n\n    // サイドバーのカーソル切り替え\n    {\n        "key": "ctrl+j",\n        "command": "workbench.action.focusSideBar",\n        "when": "editorFocus"\n    },\n    {\n        "key": "ctrl+j",\n        "command": "workbench.action.focusFirstEditorGroup",\n        "when": "!editorFocus"\n    },\n\n    // 左右にファイルを開いた時の切り替え\n    {\n        "key": "ctrl+w ctrl+l",\n        "command": "workbench.action.focusFirstEditorGroup",\n        "when": "!editorFocus"\n    },\n    {\n        "key": "ctrl+w ctrl+h",\n        "command": "workbench.action.focusPreviousGroup",\n        "when": "editorFocus"\n    },\n\n    // タブの切り替え\n    {\n        "key": "ctrl+h",\n        "command": "workbench.action.previousEditor",\n        "when": "editorFocus && vim.mode == \'Normal\'"\n    },\n    {\n        "key": "ctrl+l",\n        "command": "workbench.action.nextEditor",\n        "when": "editorFocus && vim.mode == \'Normal\'"\n    },\n\n    // Insert Modeでのカーソル移動\n    {\n        "key": "ctrl+l",\n        "command": "cursorRight",\n        "when": "editorTextFocus && !editorReadOnly && vim.mode != \'Normal\'"\n    },\n    {\n        "key": "ctrl+h",\n        "command": "cursorLeft",\n        "when": "editorTextFocus && !editorReadOnly && vim.mode != \'Normal\'"\n    },\n\n    // Suggestion時\n    {\n        "key": "ctrl+k",\n        "command": "acceptSelectedSuggestion"\n    },\n    {\n        "key": "ctrl+n",\n        "command": "selectNextSuggestion",\n        "when": "editorTextFocus && suggestWidgetMultipleSuggestions && suggestWidgetVisible"\n    },\n    {\n        "key": "ctrl+p",\n        "command": "selectPrevSuggestion",\n        "when": "editorTextFocus && suggestWidgetMultipleSuggestions && suggestWidgetVisible"\n    },\n\n    // 検索からファイルに移動する時\n    {\n        "key": "ctrl+n",\n        "command": "search.focus.nextInputBox",\n        "when": "inputBoxFocus && searchViewletVisible"\n    },\n\n    // 検索窓を閉じる\n    {\n        "key": "ctrl+[",\n        "command": "workbench.action.closeQuickOpen",\n        "when": "inQuickOpen"\n    },\n\n    // サイドバーでソースツリーを開いている時\n    {\n        "key": "r",\n        "command": "renameFile",\n        "when": "explorerViewletVisible && filesExplorerFocus"\n    },\n    {\n        "key": "Enter",\n        "command": "list.select",\n        "when": "explorerViewletVisible && filesExplorerFocus"\n    },\n\n    // どこにフォーカスしていても使いたいコマンド。\n    {\n        "key": "ctrl+o ctrl+d",\n        "command": "workbench.view.debug"\n    },\n    {\n        "key": "ctrl+o d",\n        "command": "workbench.view.debug"\n    },\n    {\n        "key": "ctrl+o ctrl+g",\n        "command": "workbench.view.scm"\n    },\n    {\n        "key": "ctrl+o g",\n        "command": "workbench.view.scm"\n    },\n\n    // サイドバーの表示切り替え\n    {\n        "key": "[IntlYen] v",\n        "command": "workbench.view.explorer",\n        "when": "!explorerViewletVisible && vim.mode != \'SearchInProgressMode\'"\n    },\n    {\n        "key": "[IntlYen] v",\n        "command": "workbench.action.toggleSidebarVisibility",\n        "when": "explorerViewletVisible && !searchViewletVisible && !inDebugMode && vim.mode != \'SearchInProgressMode\'"\n    },\n\n    // コマンドパレットオープン\n    {\n        "key": "ctrl+o ctrl+o",\n        "command": "workbench.action.showCommands"\n    },\n    {\n        "key": "ctrl+o o",\n        "command": "workbench.action.showCommands"\n    },\n\n    // エディター以外のビューから抜けてくるときに\n    {\n        "key": "ctrl+w",\n        "command": "workbench.action.focusActiveEditorGroup"\n    },\n\n    // Emmentをtabで展開\n    {\n        "key": "tab",\n        "command": "editor.emmet.action.expandAbbreviation",\n        "when": "config.emmet.triggerExpansionOnTab && editorTextFocus && !editorReadonly && !editorTabMovesFocus"\n    },\n\n    // ターミナル切り替え\n    {\n        "key": "ctrl+k",\n        "command": "workbench.action.terminal.toggleTerminal",\n        "when": "!terminalFocus && vim.mode != \'SearchInProgressMode\'"\n    },\n    {\n        "key": "ctrl+k",\n        "command": "workbench.action.terminal.toggleTerminal",\n        "when": "terminalFocus && vim.mode != \'SearchInProgressMode\'"\n    },\n]\n```\n\n今のところこれ以外のキーバインドは自分には必要なさそうだ。\nvimに若干慣れてない感があったり、マルチカーソル、Unde/Redoに不具合があったりしそうだけど、\n許容範囲なのでこれでやっていこうかな。\n',frontmatter:"title: VS Code + Vimで効率的にコーディング\ndate: 2018-04-14",fileName:"2018-04-14-vscodevim-keybindings"},{attributes:{title:"D3をwebpack2でbundleしてる時に、Objectでstyleやattrを設定したかったけどエラーが出てしまう件",date:new Date(14948928e5)},body:'[D3(Data-Driven-Documents)](https://d3js.org/)をwebpack2を使ってbundleしてる時に、styleやattrをobjectで設定したかったが、エラーが出てしまうので調べてみると、どうも昔は出来たがモジュールを分けたようで、object形式で指定したい時は、[d3-selection-multi](https://github.com/d3/d3-selection-multi)をimportして使ってください、という事だったので使う事にしたけど、うまく行かずハマってしまった...\n\nつたない英語力で調べていくと、どうもwebpack側の設定が必要そうだった。\n[https://github.com/d3/d3-selection-multi/issues/8](https://github.com/d3/d3-selection-multi/issues/8)\n\nまずはwebpack側の設定に下記を追記し、\n```js webpack.config.js\nresolve: {\n  alias: {\n    \'d3\': \'d3/index.js\'\n  }\n},\n```\n\n実際に使いたいJSでは、下記のように設定する事で無事に解決できた。\n```js index.js\nimport * as d3 from \'d3\';\nimport "d3-selection-multi";\n\nd3.select("body").append("div")\n  .attrs({\n    title: "A cheery, timeless greeting.",\n    class: "greeting"\n  })\n  .text("Hello, world!");\n```\n\npackage.jsonは下記のような形。\n```json package.json\n"dependencies": {\n  "d3": "^4.8.0",\n  "d3-selection-multi": "^1.0.1"\n},\n"devDependencies": {\n  "babel-core": "^6.24.1",\n  "babel-loader": "^7.0.0",\n  "babel-preset-es2015": "^6.24.1",\n  "webpack": "^2.5.1",\n  "webpack-dev-server": "^2.4.5"\n}\n```\n\nもうこれからは言い訳抜きで英語力が必要になってきたと感じる今日このごろ..\n',frontmatter:"title: D3をwebpack2でbundleしてる時に、Objectでstyleやattrを設定したかったけどエラーが出てしまう件\ndate: 2017-05-16",fileName:"2017-05-16-d3-webpack-multi-values"},{attributes:{title:"Reactとwebpack2での環境構築",date:new Date(14948064e5)},body:'webpack2でReact環境を小さく構築する時の備忘録。\nwebpack-dev-serverでローカルサーバーを立ち上げて、Reactで単なる`hoge`を出力させるまで\b。\n\n### 全体の\b\b構成図\n```bash\n\b/\n├public\n  └index.html 本番のhtmlファイル\n└src\n  └index.js 開発時のjsファイル\n.babelrc\npackage.json\nwebpack.config.js\n```\n\n### package.jsonの作成\n```bash\nyarn init -y\n```\n\n### dependenciesなモジュールをインストール\n```bash\nyarn add react react-dom\n```\n\n### devDependenciesなモジュールをインストール\n```bash\nyarn add -D babel-core babel-loader babel-preset-es2015 babel-preset-react webpack webpack-dev-server\n```\n\n### .babelrcをルートに作成\n```json .babelrc\n{\n  "presets": ["es2015", "react"]\n}\n```\n\n### srcとpublicの2つのディレクトリを作成\n```bash\nmkdir src public\n```\n\n### publicの中に、index.htmlを作成\n```html index.html\n<!DOCTYPE html>\n<html lang="ja">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <meta http-equiv="X-UA-Compatible" content="ie=edge">\n  <title>Document</title>\n</head>\n<body>\n  <div id="app"></div>\n  <script src="./bundle.js"><\/script>\n</body>\n</html>\n```\n\n### webpack.config.jsを作成\n```js webpack.config.js\nconst path = require(\'path\');\n\nconst src_path = path.resolve(__dirname, \'src\');\nconst public_path = path.resolve(__dirname, \'public\');\n\nmodule.exports = {\n  entry: `${src_path}/index.js`,\n\n  output: {\n    path: public_path,\n    filename: \'bundle.js\'\n  },\n\n  devServer: {\n    contentBase: public_path // webpack-dev-serverのルートディレクトリ\n  },\n\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        exclude: /node_modules/,\n        use: [\n          { loader: \'babel-loader\' }\n        ]\n      }\n    ]\n  }\n};\n```\n\n### srcの中に、index.jsを作成\n```js index.js\nimport React from \'react\';\nimport ReactDOM from \'react-dom\';\n\nconst App = () => (\n  <div>hoge</div>\n);\n\nReactDOM.render(\n  <App />,\n  document.getElementById(\'app\')\n);\n```\n\n### package.jsonに"scripts"を追記する\n```json package.json\n{\n  ...\n  "scripts": {\n    "start": "webpack-dev-server",\n    "build": "webpack"\n  },\n  ...\n}\n```\n\nここまでで環境構築が完了したので、\n開発時は、`yarn start` すると`http://localhost:8080/`でローカルサーバー(LiveReroad)が立ち上がり、\n本番時は、`yarn build` するとpublicにbundle.jsが書き出される。\n\n※ただ`yarn build`は本番用のminifyなど何も入ってないので、本番用の設定は\b適宜入れる必要がある。\n[https://webpack.js.org/guides/production-build/](https://webpack.js.org/guides/production-build/)\n\n### [追記 2017/5/15]\nPropTypesはクラスのstaticなプロパティで指定するのが流れのようで、\nbabelだと、`babel-plugin-transform-class-properties`を使う事が多そうなので追記しておく。\n\n```bash\nyarn add -D babel-plugin-transform-class-properties\n```\n\n```json .babelrc\n{\n  ...\n  "plugins": ["transform-class-properties"] // 追記\n}\n```\n\nPropTypesの設定例\n```js Counter.js\n...\nimport PropTypes from \'prop-types\';\n\nclass Counter extends Component {\n  static propTypes = {\n    value: PropTypes.number.isRequired,\n    onIncrement: PropTypes.func.isRequired,\n    onDecrement: PropTypes.func.isRequired\n  }\n  ...\n}\n```\n',frontmatter:"title: Reactとwebpack2での環境構築\ndate: 2017-05-15",fileName:"2017-05-15-react-webpack-bioplate"},{attributes:{title:"シンプルなSPA構築 director",date:new Date(14940288e5)},body:"2017年でこのポストはだいぶ時代遅れ間がありそうだけど、\nシンプルなSPA構築する時に便利なdirectorの使い方メモ。\n\nそんなに大きくないアプリケーションとかで、\njQueryとか流行りのフレームワークなしでシンプルにSPA構築したい時に\n自分で一からネイティブに実装しても良いとは思うけど、\nシンプルに使えるdirectorを使うと良さそう。\n\n[director](https://www.npmjs.com/package/director#history-api)\n\nUsageに使い方など載ってはいるけど、簡単なexampleを。\n\ndirectorのインストール\n```bash\nyarn init -y\nyarn add director # or npm install director --save\n```\n\n`#/hoge`と`#/fuga`へのアクセスで指定の関数を実行する例だとすると..\n```js\n// app.js\n\nvar hoge = function() {\n  console.log('hoge');\n};\n\nvar fuga = function() {\n  console.log('fuga');\n};\n\nvar routes = {\n  '/hoge': hoge,\n  '/fuga': fuga\n}\n\nvar route = new Router(routes);\nroute.init();\n```\n\nHTMLで`#/hoge`、`#/fuga`のリンク設定。\n```html\n<ul>\n  <li><a href=\"#/hoge\">#/hoge</a></li>\n  <li><a href=\"#/fuga\">#/fuga</a></li>\n</ul>\n<script src=\"./node_modules/director/build/director.min.js\"><\/script>\n<script src=\"./app.js\"><\/script>\n```\n\n小規模サイトでDOM操作もそんなに無いって要件の時は良いかもしれない。\n\n",frontmatter:"title: シンプルなSPA構築 director\ndate: 2017-05-06",fileName:"2017-05-06-director"},{attributes:{title:"Flexboxの子要素がインラインだとiOS8などで要素が消えちゃう問題",date:new Date(14935104e5)},body:"Flexboxの子要素にインライン要素(spanとかaタグ)を使用する事があって、\n主要ブラウザの確認では特に問題なかったので普通に使えるんだろうと思ってましたが、\niOS8やAndroid4.2以下辺りではその子要素が消えてしまうようで..勉強不足でした..><\n\n子要素に対して、 display: block; を入れて解決でした。\ninline-blockでもいいのかな。\n",frontmatter:"title: Flexboxの子要素がインラインだとiOS8などで要素が消えちゃう問題\ndate: 2017-04-30",fileName:"2017-04-30-flexbox-inline-element"},{attributes:{title:"AndroidのWebViewでスクロールが重たい問題の改善",date:new Date(1489536e6)},body:"とあるAndroidアプリ案件でWebViewのスクロールが重たい報告があがってきました。\n\nスクロールしようとしてもAndroidはスムーズにいかず、反応が鈍い感じ..\n同じ端末のデフォルトブラウザ(Web)やiOSは特に問題なしで、AndroidのWebViewのみ顕著に重たい状況でした。\n\nJavaScriptもそれなりに入っているページだったので、\n最初はJavaScriptのリファクタリングを頑張ってましたが、\n頑張ってはみたもののそこまでの改善は見られず..\n\nまた大きい画像もあったのでレンダリング処理に時間かかってるのかなという事で、\n最適な画像を準備するようにしても、あまり変わらず..\n\n困り果てて調べていたところ、CSSの可能性が。\n\n[フロントエンドチューニングの箇条殴り書き ::ハブろぐ](https://havelog.ayumusato.com/develop/performance/e569-frontend_performance_memo.html)\n\n[[CSS] border-radiusとbox-shadowを組み合わせると、それぞれ単体でのスタイルより５倍重たい！？](http://www.yoheim.net/blog.php?q=20130713)\n\n`border-radius` と `box-shadow` の組み合わせ。\nどうも今回のケースはこれが原因のようでした。\n`box-shadow` を無くしたり、`border-radius`を角丸の画像(懐かしいやり方)に変えたりしたところ、かなり改善されました。\n\nこれらのCSS3系プロパティが重たいというのは聞いてはいたが、ここまでとは。\n特に `border-radius` と `box-shadow` の組み合わせは、よくありそうなケースなので注意が必要ですね。\n勉強になりました。\n",frontmatter:"title: AndroidのWebViewでスクロールが重たい問題の改善\ndate: 2017-03-15",fileName:"2017-03-15-android-webview-scroll-heavy"},{attributes:{title:'webpack + AutoPrefixerで、"display:-webkit-flex;"が消えてしまう問題',date:new Date(14893632e5)},body:"とある案件で、webpack + AutoPrefixerを使ってて、\nCSSの出力結果から `display: -webkit-flex;` とかが何故か抜けててしまってて、\nAndroid4系とかの一部端末で横並びが効いてない事があったので、その時の実装メモ。\n\n[AutoPrefixerのドキュメント](https://github.com/postcss/autoprefixer#no-prefixes-in-production)に記載がありましたが、\n原因は、webpackとかのビルドツールにもAutoPrefixerが含まれていて、\nそのツールを使ってAutoPrefixerを使うとそのツールの\nデフォルトのブラウザリストを使うので、\n結果的にプレフィックスを削除するよ、的な事のようでした。\n\nAutoPrefixerのブラウザリストの設定は、\n`browserslist` のファイルをルートに置くか、\npackage.jsonのkeyに `browserslist` を設定する事が推奨されているようなので、\npackage.jsonに設定を移す事で無事に解決できました。\n\nwebpack2 + ReactでCSSモジュールを構築した時も同じ問題に直面したりして、\nwebpack.config.jsやgulpfile.jsなどに記載していたAutoPrefixerのBrowserlistを、\nこちらの[package.json](https://github.com/NaokiOtsu/Tips/blob/master/React/ReactCSSModule/package.json#L26-L30)のように記載して解消されました。\n",frontmatter:'title: webpack + AutoPrefixerで、"display:-webkit-flex;"が消えてしまう問題\ndate: 2017-03-13',fileName:"2017-03-13-webpack-autoprefixer-setting"},{attributes:{title:"JavaScriptでCSSの値を取得する / getComputedStyleとparseInt,parseFloat",date:new Date(14866848e5)},body:"# getComputedStyle\n\n普段、jQueryなどを使っていたら `.css()` などを使うので、ほとんど使わないメソッドだとは思うんですが、ピュア(Vanilla)なJavaScriptでCSSの値を取得したい時は、 `window.getComputedStyle()` を使うと取得できます。\nIE9以上のモダンブラウザで使用出来ます。\n\n例えば要素の高さを取得したい時は、下記のように取得できます。\n\n```\nvar element = document.getElementById('target');\nwindow.getComputedStyle(element, null).height; // `30px` など\n```\n\n第一引数が取得したいDOM要素、第二引数は基本的にnullで `:before` 要素とかを取得したい時に ':before' などを指定すると良さそうです。\n\n# parseIntとparseFloat\n\nこの時、例えば `30px` など `px` が入った文字列が取得できるのですが、これを `30` など数値のみに変換したい事も出てきます。\n自分は数値変換では `Number()` を使う事が多いんですが、 `Number()` だと数値に変換出来ない文字列があった場合は `NaN` を返してしまうので、この場合は使えません。\n\n正規表現でやるのかなと思いましたがそんな事はなく、 `parseInt()` や `parseFloat()` を使うと柔軟に対応してくれそうです。\n `parseInt()` は整数だけを解析、 `parseFloat()` は整数と浮動小数点の両方を解析してくれて、両方とも文字列の前の空白や最後の数値変換出来ない文字列は無視してくれます。\n\n ```\n parseInt('30px', 10); // 30\n ```\n\n無事に数値のみ取得できました。\n良くわかってなかった部分の備忘録でした。\n",frontmatter:"title: JavaScriptでCSSの値を取得する / getComputedStyleとparseInt,parseFloat\ndate: 2017-02-10",fileName:"2017-02-10-getcomputedstyle-parseint-css-js"},{attributes:{title:"git checkout --ours と --theirs - コンフリした時の対処",date:new Date(1482192e6)},body:"gitでコンフリした時に、通常だと差分を見て手動で解決していきますが、\nHEAD側か、マージさせた側かに全ての変更を適用したい場合もあったりして、\nその場合は、 `git checkout --ours` もしくは `git checkout --theirs` を使うと良いのですが、\nどちらがどちらになるのかよく忘れてしまうので備忘録です。\n\n![git checkout --ours or --theirs](/blog/images/git_checkout_ours_theirs.png)\n\n`--ours`がHEAD側、`--theirs`がマージさせた側(自分が直前に作業した内容な事が多そうでしょうか)となるようです。\n",frontmatter:"title: git checkout --ours と --theirs - コンフリした時の対処\ndate: 2016-12-20",fileName:"2016-12-20-git-checkout-ours-theirs"},n,{attributes:{title:"git cloneしたsubmoduleを自分のリポジトリで管理する",date:new Date(14808096e5)},body:"gitで、プロジェクトのリポジトリ内で、別のsubmoduleを`git clone`などして、\n更に、そのsubmoduleに変更を加えたりすると下記のような表示となり、\nファイルは変更されているけど、このファイルはsubmoduleで他のリポジトリで管理されているファイルだから`untracked content`だよ、というようなメッセージが表示される事があります。\n\n``` shell\nmodified:   something/file (modified content, untracked content)\n```\n\nこの場合、この変更が特に必要ないものならば、\n```\n$ cd something/file\n$ git checkout .\n```\nで変更をなかった事にすれば元には戻るのですが、\n変更が必要なもので、今後はsubmoduleを自分のリポジトリで管理していきたい場合は\n`.git`を削除する事で、submoduleから外す事ができます。\n**※注意点としては、そのsubmoduleのLicenseには十分気をつけなければいけない事と、そのsubmoduleは元リポジトリの管理から外れるので、以降はpullしてこれない等があります。**\n\n```\n$ git rm --cached something\n$ rm -rf something/.git\n```\n\nこれで、submoduleをプレーンなファイルにして(.gitを削除して)、自分のリポジトリ配下のファイルとなります。\n\n参考: http://stackoverflow.com/questions/4161022/git-how-to-track-untracked-content",frontmatter:"title: git cloneしたsubmoduleを自分のリポジトリで管理する\ndate: 2016-12-04",fileName:"2016-12-04-git-submodule-replace-plain-content"},{attributes:{title:"ローカルにPHP環境構築してBrowserSyncでLiveReload",date:new Date(14802912e5)},body:"MacのローカルにPHP環境構築して、<a href=\"https://www.browsersync.io/\" target=\"_blank\">BrowserSync</a>でLiveReloadさせた時のMEMOです。\n\n## 実装方法\n調べた結果、<a href=\"https://www.npmjs.com/package/gulp-connect-php\" target=\"_blank\">gulp-connect-php</a>を使うのが早そうでした。\n\n``` shell\n$ npm init -y\n$ npm install -D gulp gulp-connect-php browser-sync\n```\n\n``` js gulpfile.js\nvar gulp        = require('gulp');\nvar connect     = require('gulp-connect-php');\nvar browserSync = require('browser-sync').create();\n\ngulp.task('connect-sync', function() {\n  connect.server({}, function() {\n    browserSync.init({\n      proxy: '127.0.0.1:8000'\n    });\n  });\n\n  gulp.watch(['./*.php', './*.css', './*.js']).on('change', browserSync.reload);\n});\n\ngulp.task('default', ['connect-sync']);\n```\n\nこれで <code>gulp</code> を叩いたら無事に構築出来ました。",frontmatter:"title: ローカルにPHP環境構築してBrowserSyncでLiveReload\ndate: 2016-11-28",fileName:"2016-11-28-local-php-browser-sync"},{attributes:{title:"Youtubeの再生リストの動画を一覧表示する - Youtube Data API v3",date:new Date(14789952e5)},body:'自分のプライベートなプロダクトで、\nYoutubeの再生リストの動画を一覧表示する機能が入れる必要がありまして、\n<a href="https://developers.google.com/youtube/v3/getting-started?hl=ja" target="_blank">Youtube Data API v3 のガイド</a>を見ながらやっていましたが、\nスムーズに行かなかったので結論の実装方法をメモしておくことにしました。\n\n<h2><strong>実装方法</strong></h2>\n\n下記の4ステップを踏むと良かったです。\n\n<h3><strong>1. APIキーを取得する</strong></h3>\n\n<a href="https://developers.google.com/youtube/registering_an_application?hl=ja" target="_blank">こちら</a>の手順を踏んで、APIキーを取得します。\n\n<h3><strong>2. 表示したい動画のリクエストURLを<a href="https://developers.google.com/youtube/v3/docs/?hl=ja" target="_blank">リファレンス</a>から調べます</strong></h3>\n\n自分の場合は、再生リストの一覧が欲しかったので、<a href="https://developers.google.com/youtube/v3/docs/playlistItems/list?hl=ja" target="_blank">こちら</a>のリクエストURLが必要でした。\n\n``` php\nGET https://www.googleapis.com/youtube/v3/playlistItems\n```\n\nGET形式で、このURLにリクエストをすれば良いようです。\n\n<h3><strong>3. 再生リストのIDを調べる</strong></h3>\n\n再生リストを表示したい場合は、再生リストIDというのが必要なようでした。\nチャンネルIDとかも必要なのかなと思っていましたが、それは必要なかったです。\n\n再生リストIDは、例えば\n<a href="https://www.youtube.com/playlist?list=PLlVlyGVtvuVnAx-u38QOieyVIrMEmzuDx" target="_blank">https://www.youtube.com/playlist?list=PLlVlyGVtvuVnAx-u38QOieyVIrMEmzuDx</a>\nの再生リストのIDは、\n\n```\nPLlVlyGVtvuVnAx-u38QOieyVIrMEmzuDx\n```\n\nのように、URLの最後の部分になるようです。\n\n<h3><strong>4. Ajaxでリクエストを投げてレスポンスを表示する</strong></h3>\n\nYoutube Data API v3のガイドだと、リクエストURLに <code>?part=</code> とかを付けて、受け取ってねとありましたが、\njQueryとかだと、下記のようにリクエストを投げても、無事に欲しいレスポンスが返ってくるので、自分はこっちで実装しました。\n\n``` js\n$.ajax({\n  type: \'get\',\n  url: \'https://www.googleapis.com/youtube/v3/playlistItems\', // リクエストURL\n  dataType: \'json\',\n  data: {\n    part: \'snippet\', // partは必須で指定が必要とのこと。レスポンスで返してもらいたいデータをカンマ区切りで指定する。snippetがあればとりあえず動画を再生するレスポンスが受け取れる。\n    playlistId: \'PLlVlyGVtvuVnAx-u38QOieyVIrMEmzuDx\', // 再生リストID\n    maxResults: 20, // デフォルトは5件までしか受け取らないので、取得件数を変更\n    key: \'{APIキー}\'\n  }\n}).done(function(response) {\n  // 成功\n}).fail(function() {\n  // エラー\n});\n```\n\nこれで入力項目が問題なければ、成功するので、\nあとは、返ってきた <code>response</code> から動画を表示させれば良いです。\n\n``` js\nresponse.items.forEach(function(item) {\n    var id = item.snippet.resourceId.videoId;\n    $(\'#list\').append(\'&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/\'+ id +\'" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;\');\n});\n```',frontmatter:"title: Youtubeの再生リストの動画を一覧表示する - Youtube Data API v3\ndate: 2016-11-13",fileName:"2016-11-13-youtube-play-list-youtube-data-api-v3"},{attributes:{title:"Font Awesomeで、「Failed to decode downloaded font」が出てしまう時",date:new Date(14788224e5)},body:'<a href="http://fontawesome.io/" target="_blank">Font Awesome</a>を使っていて、本番サイトで確認しようとしたら、\nフォントが正しく出ていない... ローカルでは大丈夫だったのに..\n\nそして、コンソールを見たら、\n**「Failed to decode downloaded font」**\nとか\n**「OTS parsing error: incorrect file size in WOFF header」**\nとか出ている様子..。\n\n## 原因\n調べてみると、gitの改行コードを変換する仕組みによって起きてるようでした。\n参考: <a href="http://ts0818.hatenablog.com/entry/2016/04/01/225341" target="_blank">『Failed to decode downloaded font』から始まるエラー</a>\n\n## 対策\ngitのルートディレクトリにある、「.gitattributes」ファイルを開いて、\n変換しないように下記を追加してあげると問題ありませんでした。\n\n```\n# Denote all files that are truly binary and should not be modified.\n... 中略\n*.otf binary\n*.eot binary\n*.svg binary\n*.ttf binary\n*.woff binary\n*.woff2 binary\n```\n\nもう一度、正しいフォントを格納して、git pushして確認したところ無事解決でした。\n',frontmatter:"title: Font Awesomeで、「Failed to decode downloaded font」が出てしまう時\ndate: 2016-11-11",fileName:"2016-11-11-font-awesome-error"},{attributes:{title:"ソフトバンク 孫社長",date:new Date(14779584e5)},body:'<iframe width="560" height="315" src="https://www.youtube.com/embed/zhrz8KdUB4w" frameborder="0" allowfullscreen></iframe>\n\n孫社長はずっと前から尊敬している事業家のお一人で、\n2005年、東京ビックサイトで行われたソフトバンクBBの新卒入社式で、豆粒ぐらいとても遠くでお話されていたのにすごく感動したのを思い出す。\n\n本や雑誌でも様々なことを学ばせて頂いていますが、\nこの動画でおっしゃってる事や考えが原点にあるような気がしていて、これまでにも何度も見てきた。\n\nお金とか地位とか名誉とかそんなことじゃなく、自分がやりたいと思った事を貫くかっこよさ。\n自分が死ぬ前に、あ〜無難に生きたな、出世できたなとかそんな小さな事じゃなく、\n心からやりたい事を本気でやったなと思って死にたい。\nそんな想いをこの動画から感じる。\n\nそんな孫社長が何かの折に「流行りのおっかけ屋さん」という表現をおっしゃっていたのを聞いて、そのフレーズに自分の中ではドキっとした。\nそれは自分の今の職業(フロントエンドエンジニア)やITという業界そのものが、流行りのおっかけ要素が満載だからかなと思う。\n決して今の職業や業界が嫌いとかじゃなく大好きだけど、技術はあくまで手段で、\n「使っている方に何を提供したのか」ってところがほんとに大事で、その部分の意識の持ち方によって日々の過ごし方もガラっと変わってきそうだ。\n\n高い技術はもちろん大切。\nただ高い技術を持つより大切なのは、もっと愚直に使ってくれている方に目を向けた思いやりの気持ちで、場合によっては技術自体は超古いんだけど、使う人にとっては最高の体験を提供している事が工数1時間で実装出来た、なんて事が全然起こり得ると思っている。\nだからこそ、そこに対して日々向き合っていかないと「ただの流行りのおっかけ屋さん」になってしまう、ということを思ったりした。\n',frontmatter:"title: ソフトバンク 孫社長\ndate: 2016-11-01",fileName:"2016-11-01-softbank-son-president"},{attributes:{title:"CakePHP3とBrowserSyncでのLiveReload",date:new Date(14776992e5)},body:'CakePHP3でWebアプリの開発をしていましたが、\nBrowserSyncを使ってLiveReloadさせて効率よく開発していきたい事があります。そんな時のMEMOを残しておきます。\n\n## 実装方法\nCakePHPでは\n\n``` shell\nbin/cake server\n```\n\nで、デフォルトは、 <code>localhost:8765</code> のサーバーが立ち上がりますが、\n\nまずはこれを、\n\n``` shell\nbin/cake server -H {IPアドレス} -p 8765\n```\n\nで起動させて、 {IPアドレス}:8765 で立ち上がるようにします。\n\nそしてBrowserSync側では、optionsのproxyとportを設定すれば良さそうです。\n\n``` js gulpfile.js\n{\n    proxy: "{IPアドレス}:8765",\n    port: 4000\n}\n```\n\nこれでBrowserSyncをstartさせたら、\nhttp://{IPアドレス}:4000/ もしくは http://localhost:4000 へのアクセスで問題なくLiveReload出来ました。\n',frontmatter:"title: CakePHP3とBrowserSyncでのLiveReload\ndate: 2016-10-29",fileName:"2016-10-29-cakephp3-browser-sync-live-reload"},{attributes:{title:"Vagrantで開発環境構築(PHP+Mysql) &#124; VirtualBox",date:new Date(14773536e5)},body:'Vagrantで開発環境構築(PHP+Mysql)した時のメモです。\n\n## 参考にした記事\nこちらの記事を参考に構築しました。\n<a href="http://fnya.cocolog-nifty.com/blog/2015/12/vagrant-centos7.html">http://fnya.cocolog-nifty.com/blog/2015/12/vagrant-centos7.html</a>\n\nシンボリックリンクを貼って、ローカルPCからファイル編集出来るようにするのに、下記を参照しました。\n<a href="http://qiita.com/tiwu_official/items/f135e6b6fbbe3ec6aa54#8%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AA%E3%83%83%E3%82%AF%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%AE%E4%BD%9C%E6%88%90">http://qiita.com/tiwu_official/items/f135e6b6fbbe3ec6aa54#8%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AA%E3%83%83%E3%82%AF%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%AE%E4%BD%9C%E6%88%90</a>\n\nただファイル共有が使えないエラーが出てた。ので下記を参考に解決しました。\n<a href="http://stackoverflow.com/questions/22717428/vagrant-error-failed-to-mount-folders-in-linux-guest">http://stackoverflow.com/questions/22717428/vagrant-error-failed-to-mount-folders-in-linux-guest</a>',frontmatter:"title: Vagrantで開発環境構築(PHP+Mysql) &#124; VirtualBox\ndate: 2016-10-25",fileName:"2016-10-25-vagrant-php-mysql-virtualbox"},{attributes:{title:"JavaScriptで要素の入れ替え - replaceChild, cloneNode",date:new Date(14746752e5)},body:"ピュア(Vanilla)なJavaScriptでの要素の入れ替えのMEMOです。\n例えばAとBの要素を入れ替えたい時などに使います。\n\n## 実装方法\n``` js\nvar clone_A = element_A.cloneNode(true);\nvar clone_B = element_B.cloneNode(true);\n\nelement_A.parentNode.replaceChild(clone_A, element_B);\nelement_B.parentNode.replaceChild(clone_B, element_A);\n```\n\ncloneNodeで要素のクローンを作った後に、replaceChildで置換します。\ncloneNodeの引数は、nodeの子孫ノードも複製する場合はtrue\nnodeのみを複製する場合はfalseとなります。",frontmatter:"title: JavaScriptで要素の入れ替え - replaceChild, cloneNode\ndate: 2016-09-24",fileName:"2016-09-24-javascript-replace-child-clone-node"},{attributes:{title:"JavaScriptでペアな配列を作る時のMEMO",date:new Date(14745024e5)},body:"神経衰弱を作る時のような、[1, 1, 2, 2]のようなペアな値を持った配列が欲しい時の実装MEMOです。\n\n``` js\nvar cards = [];\nfor (var i = 1; i &lt;= 2; i++) {\n    cards[cards.length] = i;\n    cards[cards.length] = i;\n}\nconsole.log(cards); // [1, 1, 2, 2]\n```",frontmatter:"title: JavaScriptでペアな配列を作る時のMEMO\ndate: 2016-09-22",fileName:"2016-09-22-javascript-pare-array-create"},{attributes:{title:"JavaScriptで配列をシャッフルさせる",date:new Date(14745024e5)},body:'ピュア(Vanilla)なJavaScriptでの配列のシャッフル。\n\n``` js\nvar targets = [1,2,3,4,5];\nvar results = [];\nwhile (targets.length) {\n    results.push(targets.splice(Math.floor(Math.random() * targets.length), 1)[0]);\n}\nconsole.log(results); // 例: [5, 1, 4, 3, 2]\n```\n\n## ただちょっと注意も\n※ただこのやり方だと全く同じ配列が返されてしまう場合もあります。\n間違いなくシャッフルさせなければいけない時の記述はもう少し複雑になりますが、下記を参照すると良いです。\n\n<a href="https://h2ham.net/javascript-%E3%81%A7%E9%85%8D%E5%88%97%E3%81%AE%E3%82%B7%E3%83%A3%E3%83%83%E3%83%95%E3%83%AB">JavaScriptで配列のシャッフル</a>',frontmatter:"title: JavaScriptで配列をシャッフルさせる\ndate: 2016-09-22",fileName:"2016-09-22-javascript-array-shuffle"},{attributes:{title:"addEventListenerに引数を渡しつつremoveEventListenerしたい時",date:new Date(14745024e5)},body:"全然スマートじゃないので、もっと良い方法ありそうですが、、一応備忘録で残しておきます。\n\n``` js\nelement.addEventListener('click', function onClick() {\n    onClickHandler(onClick, '渡したい引数');\n});\n\nfunction onClickHandler(func, text) {\n    console.log(text); // 渡したい引数\n    element.removeEventListener('click', func);\n}\n```",frontmatter:"title: addEventListenerに引数を渡しつつremoveEventListenerしたい時\ndate: 2016-09-22",fileName:"2016-09-22-javascript-addeventlistener-param-removeeventlistener"},{attributes:{title:"SVGで円をアニメーションさせたい時のMEMO",date:new Date(14741568e5)},body:'ローディングバーや円グラフを表示したい時など、\nくるっと回る円のアニメーションを作りたい時があります。\n\n<img src="https://qiita-image-store.s3.amazonaws.com/0/2582/b6d35e8d-0301-57c4-e4c3-2b12ed7fafd9.png" alt="Create_a_New_Pen.png" />\n\nhttp://codepen.io/melo15/pen/yJmVEJ\n\n## 実装方法\n下記のように実装すると良いです。\n\n``` html\n<svg width="124" height="124">\n    <circle cx="62" cy="62" r="60" />\n</svg>\n```\n\n``` css\nsvg {\n    transform: rotate(-90deg);\n}\n\ncircle {\n    fill: transparent;\n    stroke: #4fa8df;\n    stroke-width: 4;\n    animation: circle 1s infinite;\n}\n\n@keyframes circle {\n  0% { stroke-dasharray: 0 377; }\n  99.9%,to { stroke-dasharray: 377 377; }\n}\n```\n\n## 対応ブラウザ\nインラインSVGなので、モダンブラウザは対応していて、\nIE8以下、Android2系以下辺りは使えなさそうです。\nhttp://caniuse.com/#feat=svg-html5\n\n## 実装方法\n半径60pxの円を作りたいとすると、\n<code>&lt;svg&gt;</code>の<code>width</code>と<code>height</code>には、<code>60px x 2 = 120px</code>\nこれに、のちのち設定する円の外側の線幅(stroke-width)の4pxを足して、124pxを設定します。\n<code>&lt;circle&gt;</code>の<code>cx</code>と<code>cy</code>には、124pxの半分の値を設定し、円を<code>&lt;svg&gt;</code>の中央に配置します。\n<code>r</code>は円の半径で60pxを設定しますが、この値によって後々アニメーションさせる時の値が変わってきます。\n\n### CSSでは\n<code>&lt;circle&gt;</code>の<code>fill</code>を<code>transparent</code>にして塗りつぶしなしに設定します。\n<code>stroke</code>と<code>stroke-width</code>を指定して、円の外側に線を表示します。\nこれを<code>animation</code>を使って、くるっと回るアニメーションにします。\n\n### アニメーションでは\n破線を設定する<code>stroke-dasharray</code>を使います。\n<code>stroke-dasharray: 破線の長さ 破線の間隔;</code>\nこの破線の長さをアニメーションさせる事で、くるっと回るアニメーションとなります。\n\n### 破線の間隔の値\nこの時、破線の間隔の値は、円周の長さを設定する必要があり、計算によって導きます。\n円周の長さは<code>直径 x 3.14</code>で計算します。\n今回は、<code>120 x 3.14 = 376.8</code>なので、小数点を切り上げて<code>377</code>としました。\nあとは、破線の長さを0から377までアニメーションさせると、くるっと1周するアニメーションとなります。\n\n``` css\n@-webkit-keyframes circle {\n  0% { stroke-dasharray: 0 377; }\n  99.9%,to { stroke-dasharray: 377 377; }\n}\n```\n\n### 1周ではなく半分のところで止めたい場合は\n半分のところで止めたい場合は、<code>377 / 2 = 188.5</code>などを設定すると良いです。\n\n最後に、そのままだとアニメーションの開始点が90度ずれてしまうので、\n<code>&lt;svg&gt;</code>に<code>transform: rotate(-90deg);</code>を設定して、上からくるっと回るアニメーションにします。\n\n同じようなアニメーションのデモも、CodePenにあったのでメモしておきます。\n\nhttps://codepen.io/kyledws/pen/Gvelt/\n',frontmatter:"title: SVGで円をアニメーションさせたい時のMEMO\ndate: 2016-09-18",fileName:"2016-09-18-svg-circle-animation"},{attributes:{title:"ボタンのデザインを変えずに、クリック領域だけ広げるTips",date:new Date(14741568e5)},body:"「<a href=\"https://www.amazon.co.jp/CSS%E3%82%B7%E3%83%BC%E3%82%AF%E3%83%AC%E3%83%83%E3%83%88-%E2%80%9547%E3%81%AE%E3%83%86%E3%82%AF%E3%83%8B%E3%83%83%E3%82%AF%E3%81%A7CSS%E3%82%92%E8%87%AA%E5%9C%A8%E3%81%AB%E6%93%8D%E3%82%8B-Lea-Verou/dp/4873117666/ref=sr_1_1?ie=UTF8&amp;qid=1474188594&amp;sr=8-1&amp;keywords=CSS%E3%82%B7%E3%83%BC%E3%82%AF%E3%83%AC%E3%83%83%E3%83%88\">CSSシークレット</a>」で書かれていた備忘録で、言葉では伝えるのが難しいですが、\n開発していると、ボタンそのもののwidthとheightでは領域が狭くて、ユーザーさんはクリックしにくい、\nただそのボタンのデザインは変更せずに、クリックできる領域だけを広げたいという時があります。そんな時の実装方法です。\n\n## 実装方法\n擬似要素を使って下記のように実装します。\n\n``` css\n.target {\n    position: relative;\n}\n.target:before {\n    content: '';\n    position: absolute;\n    top: -15px; bottom: -15px; right: -15px; left: -15px;\n}\n```\n\n上記の場合、ボタンの周りに15pxクリック領域が出来ます。\n\n## 他のやり方も\n擬似要素を既に使っている時は、ボーダーを使ったやり方もあります。\n\n``` css\n.target {\n    border: 15px solid transparent;\n}\n```\n\nこの場合、ボタン領域に15pxの透明なボーダーが出来て領域が広がります。\n\nもしこれでボタンの背景が広がってしまう場合は、background-clip: padding-box;を指定することで回避することもできます。\n\n``` css\n.target {\n    border: 15px solid transparent;\n    background-clip: padding-box;\n}\n```\n",frontmatter:"title: ボタンのデザインを変えずに、クリック領域だけ広げるTips\ndate: 2016-09-18",fileName:"2016-09-18-no-change-button-design-click-scale"},{attributes:{title:"BrowserSync導入メモ",date:new Date(14741568e5)},body:'さっとローカルサーバーを立ち上げて、BrowserSyncさせたい時のメモ。\n\n## セットアップ\nまずは作業場所で、セットアップ。\n\n``` shell\n$ yarn init -y\n$ yarn add -D browser-sync\n```\n\npackage.jsonにシェルを記載する。\n\n``` json package.json\n"scripts": {\n  "start": "browser-sync start --server --files \'**/*\'"\n},\n```\n\n## yarn start でスタート\n`yarn start`でブラウザが開いてローカルサーバーが立ち上がり、\nファイルを監視して、BrowserSyncが開始される。\n\nSync時に右上に表示されるお知らせは無くしたい時は、`--no-notify`を付けると良い。\n他にオプションを付けたい時は下記を参照すると良いです。\n[https://www.browsersync.io/docs/command-line#start](https://www.browsersync.io/docs/command-line#start)\n',frontmatter:"title: BrowserSync導入メモ\ndate: 2016-09-18",fileName:"2016-09-18-live-reload-browser-sync"},{attributes:{title:"border-imageをRetina対応させるときの備忘録",date:new Date(14741568e5)},body:'border-imageを使う時は、\n<a href="http://border-image.com/">http://border-image.com/</a>\nを使ってCSSソースを生成して貼り付ける事が多いのですが、\nこちらで生成されるCSSはRetina対応してない素の画像サイズなので、\nスマホ制作してる時とかは画像が大きくなってしまいます。\n\n## Retina対応させる方法\nRetina対応する場合は、<code>border-image</code>の数値は変えずに、\n<code>border-width</code>の値だけ、1/2とかにすると良いので、\n例えば、こうなっていたら↓\n\n``` css\nborder-width: 36px 40px 40px 44px;\n```\n\nこうすると良かったです↓\n\n``` css\nborder-width: 18px 20px 20px 22px;\n```',frontmatter:"title: border-imageをRetina対応させるときの備忘録\ndate: 2016-09-18",fileName:"2016-09-18-border-image-retina"},{attributes:{title:"あるボタンを押した時のアニメーション効果を連打しても確実に付けさせたい",date:new Date(14728608e5)},body:"あるボタンを押した時に、\nぽよんと反応するようなアニメーション効果を与えたい時があります。\nその要素を押したら、例えば `.click-animation`のような、ぽよんとするCSSアニメーションを付けたクラスを、付与させる事が多いのですが、そんな時の実装MEMOを残しておこうと思います。\n\n## 従来の方法\n要素を押した時に、`.click-animation`が既に付与されていたら、\n削除してから付与しないとアニメーションしなく、\nまた削除して即付与してもアニメーションしないので、\n`setTimeout()`などで適当な一定時間待って付与する事が多かったです。\n\n``` js\n$(target).removeClass('click-animation');\nsetTimeout(function() {\n    $(target).addClass('click-animation');\n}, 10);\n```\n\nもしくは、`webkitAnimationEnd`などを使って、アニメーション後にクラス削除などしていました。\n\n``` js\n$(target).addClass('click-animation');\n$(target).on('webkitAnimationEnd', function() {\n    $(target).removeClass('click-animation');\n});\n```\n\nただこれだと連打した場合に反応してくれない場合があります。\n\n## 実装方法\n`requestAnimationFrame`を使うと良さそうです。\n``` js\n$(target).removeClass('click-animation');\nrequestAnimationFrame(function() {\n    $(target).addClass('click-animation');\n});\n```\n\nこれだと高橋名人ばりに連打した場合も確実にアニメーション効果を与える事ができました。\nブラウザの次のレンダリングフレームを待ってクラス付与してるから確実ということでしょうか。\n\nGoogle I/O 2016の<a href=\"https://github.com/GoogleChrome/ui-element-samples/blob/gh-pages/swipeable-cards/cards.js#L166-L175\">実装サンプル</a>でも、`requestAnimationFrame`を使った要素の付与や削除をやってるようでした。\n",frontmatter:"title: あるボタンを押した時のアニメーション効果を連打しても確実に付けさせたい\ndate: 2016-09-03",fileName:"2016-09-03-button-click-animation"}],post:n},serverRendered:!0}}({})</script><script src="/_nuxt/35f5d4cd1087fd4c05c1.js" defer></script><script src="/_nuxt/0dbcd20913a7f489c3b7.js" defer></script><script src="/_nuxt/48b5a157089511bc5650.js" defer></script><script src="/_nuxt/8f47e504b4adc19ec417.js" defer></script><script src="/_nuxt/7d37de19250f8e71d169.js" defer></script>
  </body>
</html>
